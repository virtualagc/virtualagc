<!DOCTYPE doctype PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
  <head>
    <title>Virtual AGC Developer-Info Page</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="author" content="Ron Burkey">
    <link rel="icon" type="image/png" href="favicon.png">
    <meta name="author" content="Ron Burkey">
    <script type="text/javascript" src="Header.js"></script>
  </head>
  <body style="background-image: url(gray3.jpg);">
    <script type="text/javascript">
document.write(headerTemplate.replace("@TITLE@","Do It Yourself").replace("@SUBTITLE@","Writing AGC Software For Fun and Profit"))
</script> <br>
    <div align="center">
      <div align="left">
        <h2>Contents</h2>
      </div>
    </div>
    <ul>
      <li><a href="#Introduction">Introduction</a></li>
      <li><a href="#Basic_Facts">Basic Facts</a></li>
      <li><a href="#Your_Own_Peripheral_Devices">Your Own Peripheral
          Devices</a><br>
      </li>
      <li><a href="#Bare-Metal_Programming">Bare-Metal Programming</a></li>
      <li><a href="#Programming_for_the_AGC_Operating">Programming for
          the AGC "Operating System"</a></li>
    </ul>
    <ul>
    </ul>
    <hr style="width: 100%; height: 2px;">
    <h2><a name="Introduction"></a>Introduction</h2>
    The home page of this website semi-jokingly suggests you might want
    to use our AGC+DSKY simulation software to create a <a
      href="index.html#..._Or_for_the_silly_mood_">clock app</a> for
    your computer or perhaps write <a
      href="index.html#..._Or_for_the_even_sillier_mood_">a calculator
      program or tic-tac-toe game</a> using it ... all without giving
    you any clues as to how to go about doing such a thing.&nbsp; <br>
    <br>
    It's true that we do have a <a href="developer.html">developer page</a>,
    which goes into seemingly-endless though still-incomplete detail
    about AGC software from a developer's point of view, but the
    developer page is really focused on software developers who might
    want to create simulations for Apollo peripherals devices such as
    the Alignment Optical Telescope (AOT) or the Inertial Measurement
    Unit (IMU) that aren't otherwise provided by our Virtual AGC
    Project.&nbsp; In other words, the developer page (and most of the
    remainder of this website) caters to people who are interested in
    simulating the historical Apollo missions or flying hypothetical
    Apollo missions as accurately as possible, and who want to enrich
    that experience by creating ever-more-faithful bits and pieces of
    the simulation.<br>
    <br>
    But what if you simply want to do something fun, but different, with
    the AGC+DSKY, perhaps outside the context of simulation within a
    spacecraft environment?&nbsp; For example, to display the current
    temperature, or GPS data, or as I already said, to make a calculator
    program?<br>
    <br>
    Well, there's a variety of ways to go about doing such stuff.&nbsp;
    For example, maybe you just want to display this stuff on the DSKY
    directly, and not even bother with the AGC at all.&nbsp; If so, I
    wish you luck, but am not sympathetic to your plight.&nbsp; The <i>correct</i>
    way to go about it, in my oh-so-not-humble opinion, is to write
    actual AGC software that does whatever you need done, and let the
    simulated AGC display whatever you need on the DSKY.&nbsp; :-)&nbsp;
    That way, you not only end up with a clock or a calculator or a game
    or whatever, but you've also learned something about what it was
    like as an AGC programmer from the Apollo era, <i>and</i> have
    developed some AGC-programmer street-creds (as if there were such a
    thing).&nbsp; Now, <i>that's</i> a hobbyist project!<br>
    <br>
    This is a particularly apropos topic for anybody who has purchased a
    functional AGC+DSKY replica, such as <a
href="https://www.ebay.com/itm/DSKY-with-Integrated-AGC-runs-NASA-MIT-Code/263190750503?hash=item3d47642527:g:IwoAAOSw35lZePeX">one
of







      those sold on eBay</a> by Sam Ammons.&nbsp; It's all very well
    that you now have a working AGC plus DSKY-lookalike that can run
    (say) the Apollo 11 LM AGC software, but you don't have a LM flying
    in space, do you?&nbsp; So what good does it do you (other than
    being immensely cool)?&nbsp; Naturally, you want to justify your
    purchase by making it do something <i>else</i> too, and to amaze
    your geekish friends!&nbsp; Well, making your own custom AGC
    software is a way to do that.&nbsp;&nbsp; Since the particular
    3D-printed DSKY mentioned happens to contain a Raspberry Pi running
    our very-own Virtual AGC software, we're actually in a good position
    to understand how to adapt custom AGC software to it, though you
    don't need that specific gadget to take advantage of the info
    provided on this page.&nbsp;&nbsp;&nbsp; (Disclaimer:&nbsp; I did
    lend my sage advice and some software to the manufacturer of that
    device, which is why I know about it, but I derive no financial
    benefit from it.) <br>
    <br>
    <hr style="width: 100%; height: 2px;">
    <h2><a name="Basic_Facts"></a>Basic Facts</h2>
    At its heart, the AGC is simply a computer, like any other:&nbsp; It
    has memory which it can read to or write from for storing variables,
    it has memory that it can read from but not write to for storing its
    program, and it can execute simple instructions one after the other
    at a fixed "clock" rate.&nbsp; It has much less memory and a much
    slower clock speed and the instructions are different in detail from
    our modern-day computers, but the concept is the same.<br>
    <br>
    Of course, just being able to execute instructions is of very little
    value unless you can receive some kind of input from the outside
    world and can provide some kind of output to the outside
    world.&nbsp; Otherwise, what's the point?&nbsp; In the AGC, all of
    this connection to the outside world is provided by "i/o channels",
    which are memory-like locations into which the CPU can write data
    ("output channels") or from which it can read data ("input
    channels").&nbsp; The AGC i/o-channel address space allows for up to
    128 distinct i/o channels, the majority of which were not used for
    anything in the AGC hardware, and are assigned no specific purpose
    by the yaAGC simulation software ... thus, in writing your own AGC
    software, you can assign these unused i/o channels whatever function
    you like, as long as you have some way to feed data into the input
    channels and use the data placed in the output channels.<br>
    <br>
    So the basic steps to writing your own AGC software as follows:<br>
    <ol>
      <li>Decide what special purpose i/o you need to have, other than
        those for the DSKY (which will be handled by the existing DSKY
        software, of course), and assign channel-numbers to them in the
        unused region of the i/o-channel address space.</li>
      <li>Write a program which can feed this special purpose data into
        yaAGC (the AGC simulator) or read the special-purpose data from
        yaAGC.&nbsp; This is your own special-purpose AGC peripheral
        device.<br>
      </li>
      <li>Write AGC software that provides whatever functionality you
        want it to have, using data on these new, special-purpose i/o
        channels you've defined, and/or on pre-existing channels like
        those for the DSKY.</li>
      <li>Assemble your new AGC software using the yaYUL assembler.</li>
      <li>Simultaneously run yaAGC plus a DSKY-simulation program plus
        your new special-purpose peripheral device.</li>
      <li>...</li>
      <li>Profit!<br>
      </li>
    </ol>
    <p>Actually, I lied in the title of this page and in item #7 of the
      list above.&nbsp; There's no profit, unless your own personal
      enjoyment and sense of accomplishment counts as profit.&nbsp;
      (Prove me wrong!)&nbsp; But the other topics, #1-5, are discussed
      further throughout the remainder of this page.</p>
    <p>An important thing to know about "embedded programming", of which
      AGC software is an example, is that there are two basic varieties
      of embedded programming and embedded programmers:<br>
    </p>
    <ul>
      <li>"Bare-metal" programming — This is where you start from
        scratch, often writing the entire program yourself.&nbsp; In
        other words, you have a computer with a completely empty memory,
        with no program at all, and you write your own!&nbsp; This has
        the advantage of being simpler, since you don't have to take all
        the time to learn about how to work with all of the quirks in
        somebody else's software, and can confine yourself to worrying
        about the quirks of the hardware, which are usually
        simpler.&nbsp; This is often the approach taken in systems
        having extremely limited memory resources or speed, since such
        systems often don't have the resources to run software anybody
        else wrote anyway.&nbsp; For example, I imagine that most
        programming for <a href="https://www.arduino.cc/">Arduino
          devices</a> is of this kind.<br>
      </li>
      <li>Programming with an "operating system" — This is where the
        system is already running software that provides a lot of useful
        services (such a time-keeping functions, file-systems,
        networking, and so on), and you are merely providing one small
        piece of the system's existing software puzzle and relying on
        the operating system for a lot of stuff that would otherwise be
        troublesome.&nbsp; This has the advantage, of course, that you
        don't have to figure out for yourself how to do some of these
        very hard things.&nbsp; This is generally the approach taken in
        a system like a <a href="https://www.raspberrypi.org/">Raspberry







          Pi</a>, which is very fast and has lots of memory and
        peripheral devices.&nbsp; In fact, programming for these devices
        is hardly "embedded" programming at all, since it's really just
        like programming a desktop computer that has been put into a
        very small, cheap box.</li>
    </ul>
    <p>The AGC is an odd case, because while it has very, very small
      resources (tiny memory, terribly slow), it nevertheless has a
      pretty capable operating system written but a bunch of smart
      people.&nbsp; We will therefore cover both bare-metal programming
      and operating-system-based programming.&nbsp; My advice would be
      to start with the former until you're familiar with what you're
      doing, and then graduate to the latter if it turns out you need to
      do so.<br>
    </p>
    <hr style="width: 100%; height: 2px;">
    <h2><a name="Your_Own_Peripheral_Devices"></a>Your Own Peripheral
      Devices</h2>
    The stock version of the AGC simulator program, yaAGC, interacts
    with its peripheral devices through what I like to refer to as
    "virtual wires".&nbsp; (Some customized versions of yaGC, such as
    the one used in NASSP don't use this method, so what I have to say
    here won't fully apply to them.)&nbsp; These virtual wires are a
    networking socket interface, in which yaAGC acts something like a
    network "server", and peripheral devices connect via a networking
    socket as "clients".&nbsp; The server (yaAGC) and the peripherals
    (such as the DSKY or your own custom peripheral device) exchange
    network packets whenever the values of the AGC's i/o channels
    change.<br>
    <br>
    Okay, that was a mouthful, and sounds very complex ... but isn't
    really, because you don't really need to know about it if you use
    the handy-dandy template for creating AGC peripheral devices we
    provide.&nbsp; But it was useful background information if you're
    too stinkin' proud to use our template, so we had to tell you all
    about it anyway.&nbsp; You can find more information about it on our
    <a href="developer.html#sendrecv_Protocol">developer page</a> if you
    need to!&nbsp; <br>
    <br>
    As for the peripheral template program, though, it is called
    piPeripheral.py and <a
href="https://github.com/virtualagc/virtualagc/blob/master/piPeripheral/piPeripheral.py">you
can







      find it in our GitHub repository</a>.&nbsp; As the name implies,
    piPeripheral.py is written in <a href="https://www.python.org/">the
      Python 3 language</a>.&nbsp; Python is a kind of scripting
    language which does not need to be compiled, and hence you can
    change the program and see the effects immediately.&nbsp; It's
    available, or already automatically installed, on Windows, Mac OS X,
    Linux, and so on.<br>
    <br>
    The piPeripheral.py program is a couple of hundred lines long, and
    undoubtedly looks a bit complex if you don't know what you're
    looking at.&nbsp; Again, that complexity is an illusion, and there
    are only a couple of things you need to know to immediately begin
    working with it, if you're lucky enough to already be familiar with
    Python.&nbsp; In fact, you only need to look at or modify two of the
    program's functions, <tt>inputsForAGx</tt> and <tt>outputFromAGx</tt>:<br>
    <ul>
      <li><tt>outputFromAGx(channel,value)</tt> — This is a function
        which is called automatically whenever an output channel in the
        AGC has changed.&nbsp; The <tt>channel</tt> parameter is the
        address of the output channel, in the range 0-127 (0-0177
        octal), while <tt>value</tt> is the new value of that channel,
        in the range 0-32767 (0-077777 octal).&nbsp; Your software can
        do anything you like with this data.&nbsp; Most channels you
        will likely ignore.&nbsp; For example, there's little need to do
        anything with data in DSKY channels like 010 (octal), 011, or
        013, since the DSKY peripheral will handle those.</li>
      <li><tt>inputsForAGx()</tt> — This is a function which is
        automatically called periodically (nominally every 50 ms), which
        allows you to specify zero or more AGC input channels and values
        that are supposed to be written into those channels.&nbsp; How
        this decision is made or where the data comes from originally is
        entirely up to you.&nbsp; By default, the function simply
        returns an empty list (in Python notation <tt>[]</tt>), and so
        none of the AGC's input channels are affected.&nbsp; But if the
        returned list contains one or more items, then the corresponding
        input channels will be changed.</li>
    </ul>
    <p>Actually, the values in the list of input channels returned by <tt>inputsForAGx()</tt>
      are something the Python language calls "tuples" or specifically,
      3-tuples.&nbsp; Each 3-tuple has, as you may imagine, 3 parts:<br>
    </p>
    <blockquote>
      <p><tt>( channel, value, mask )</tt><br>
      </p>
    </blockquote>
    The interpretations of the <tt>channel</tt> and <tt>value</tt>
    parts are probably obvious.&nbsp; The <tt>mask</tt> part indicates
    which <i>bit positions</i> of the <tt>value</tt> are valid.&nbsp;
    Only the bit positions of <tt>value</tt> for which the <tt>mask</tt>
    is 1 end up affecting the AGC's input channel, and the bit positions
    in the input channel corresponding to 0 in in the <tt>mask</tt>
    remain unchanged.&nbsp; This feature is needed in general because
    some input channels have bit-fields controlled by one peripheral
    device and other bit-fields controlled by other peripheral devices,
    and you don't want a peripheral device to change the wrong
    bits.&nbsp; For i/o channels you've defined yourself, of course,
    that probably isn't an issue, and the <tt>mask</tt> could always be
    32767 (077777 octal).<br>
    <br>
    For example, in a given periodic call to <tt>inputsForAGx()</tt>,
    you might decide that the lower 3 bits of your custom input channel
    045 (octal) need to be changed to 05 (octal), and perhaps that the
    entire value of your custom channel 046 needs to be changed to
    012345.&nbsp; The list returned by <tt>inputsForAGx()</tt> would
    then be<br>
    <blockquote><tt>[ ( 0o45, 0o5, 0o00007), (0o46, 0o12345, 0o77777) ]</tt><br>
    </blockquote>
    Note that in Python 3, octal constants are prefixed by "0o".<br>
    <br>
    As for how to choose good addresses for your own custom i/o
    channels, it's probably best to avoid i/o channels already
    preassigned by the true AGC hardware and existing AGC mission
    software.&nbsp; While I'm not aware of any comprehensive list,
    addresses 0o0-0035 and 0o76-0o77 should be regarded as already
    allocated by the AGC hardware.&nbsp; In addition to those, the <i>simulated</i>
    AGC hardware, yaAGC, has defined various "fictitious i/o ports",
    working downward from address 0o177, for its own purposes.&nbsp; So
    to summarize all of that, my advice would be to confine any custom
    i/o channels you want to assign to the following ranges:<br>
    <ul>
      <li>0o40 - 0o67</li>
      <li>0o100-0o147</li>
    </ul>
    <p>As it happens, the sample peripheral program piPeripheral.py in
      our GitHub repository has been pepped up slightly from just a bare
      template.&nbsp; Additionally, it defines and processes several new
      i/o channels just to give examples of how to do so.&nbsp; This
      extra stuff is active only when the command-line switch <tt>--time=1</tt>
      (or actually, <tt>--time=<i>anything</i></tt>) is used, so you
      can easily eliminate it if you choose to build your own peripheral
      device starting from piPeripheral.py.&nbsp; Here's a list of these
      newly-assigned channels:</p>
    <ul>
      <li>AGC input channel 0o40 — Packed minutes and seconds of the
        current time, with seconds in the least-significant 6 bits and
        minutes in the next higher 6 bits.</li>
      <li>AGC input channel 0o41 — Packed month, day, and hours of the
        current date and time, with hours being the least-significant 5
        bits, day the next higher 5 bits, and month the next higher 4
        bits.</li>
      <li>AGC input channel 0o42 — The current year.</li>
      <li>AGC output channel 0o43 — The current year.</li>
      <li>AGC output channel 0o44 — The current month.</li>
      <li>AGC output channel 0o44 — The current day</li>
      <li>AGC output channel 0o44 — The current hour</li>
      <li>AGC output channel 0o44 — The current minute</li>
      <li>AGC output channel 0o44 — The current second</li>
    </ul>
    <p>The input channels are actively generated by piPeripheral.py,
      while the output channels merely have their contents printed
      out.&nbsp; The AGC program processing the input channels (in which
      the date and time is packed in a non-human-friendly way) <i>might</i>
      use the output channels for reporting human-friendly unpacked date
      &amp; time data.&nbsp; Of course, the AGC program might choose to
      do something else altogether or even nothing at all with these
      extra channels.<br>
    </p>
    <p>And of course, the main idea behind providing the current time
      and date in this way in the first place, is that it might serve as
      the basis for using the AGC+DSKY as a clock widget on a computer
      desktop.&nbsp; That's because we really <i>mean</i> the current
      time, and we don't mean something like "time since powerup", which
      is otherwise all that the AGC knows about on its own.&nbsp; This
      idea of a clock app is continued in the next section.<br>
    </p>
    <ul>
    </ul>
    <hr style="width: 100%; height: 2px;">
    <h2><a name="Bare-Metal_Programming"></a>Bare-Metal Programming</h2>
    Alas! there's nothing akin to a higher-level language such a C or
    Python for the AGC.&nbsp; Thus, programming the AGC is ultimately an
    exercise in <i>assembly-language</i> programming, and specifically
    in the assembly language that's unique to the "Block 2" AGC.&nbsp;
    This is covered in more detail than many mortals would like on our <a
      href="assembly_language_manual.html">Block 2 AGC Language page</a>,
    so to start out, you'll either want to look that over, or at least
    to look over the concise "<a
      href="http://www.ibiblio.org/apollo/hrst/archive/1689.pdf">AGC4
      Memo #9</a>" from which a lot of the information on that page
    comes.&nbsp; If you're not already somewhat-familiar with
    assembly-language programming in general, I won't pretend this will
    be easy for you.&nbsp; On the other hand, if you <i>do</i> have any
    previous familiarity with assembly language, all you'll really need
    to worry about is internalizing the AGC's unique non-contiguous
    memory map and register set, and getting an overview of the
    instruction set. <br>
    <br>
    Other than what I mentioned just now, the first important thing to
    know is that your AGC program will begin executing at address 04000
    (octal), which could look like this in assembly language:<br>
    <blockquote><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp; SETLOC&nbsp;&nbsp;&nbsp; 4000<br>
        STARTUP &nbsp;&nbsp;&nbsp; # Do your own stuff from here on<br>
      </tt></blockquote>
    But that's a bit of an over-simplification.&nbsp; The actual
    significance of address 04000 is that it's the start of an <a
      href="https://en.wikipedia.org/wiki/Interrupt_vector_table">interrupt-vector







      table</a> — i.e., of code which is instantly automatically
    executed whenever certain exceptional conditions occurs.&nbsp; For
    example, if the DSKY sends the AGC a keystroke, it instantly
    "vectors" to the code that's associated with that condition, and
    it's not something that your AGC program necessarily has to
    explicitly check for.<br>
    <br>
    There are actually 11 different interrupt sources in the AGC,
    including power-up, and each of those interrupt-sources has 4 words
    allocated for it in the interrupt-vector table at address 04000, and
    <a href="assembly_language_manual.html#Interrupt_Processing">you can
      read about them here</a>.&nbsp; You can't just ignore them, even
    if you think you don't need them for anything, because you still
    have to worry about what happens if one of those interrupts occurs:
    you can't have the code just suddenly vector off into the middle of
    nowhere!&nbsp; So a minimal version of the code above that accounts
    for the full interrupt table might look like so:<br>
    <blockquote><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp; SETLOC&nbsp;&nbsp;&nbsp; 4000<br>
        <br>
        &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        TCF&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; STARTUP</tt><tt><br>
        &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; NOOP<br>
        &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; NOOP<br>
        &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; NOOP<br>
      </tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        RESUME&nbsp;&nbsp;&nbsp; # T6RUPT</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        RESUME&nbsp;&nbsp;&nbsp; # T5RUPT</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        RESUME &nbsp;&nbsp; # T3RUPT</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        RESUME&nbsp;&nbsp;&nbsp; # T4RUPT</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; NOOP</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        RESUME&nbsp;&nbsp;&nbsp; # KEYRUPT1</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        RESUME&nbsp;&nbsp;&nbsp; # KEYRUPT2</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        RESUME&nbsp;&nbsp;&nbsp; # UPRUPT</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        RESUME&nbsp;&nbsp;&nbsp; # DOWNRUPT</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        RESUME&nbsp;&nbsp;&nbsp; # RADAR RUPT</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; NOOP</tt><tt><br>
      </tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        RESUME&nbsp;&nbsp;&nbsp; # RUPT10</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        NOOP</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; </tt><tt><br>
      </tt><tt>STARTUP&nbsp;&nbsp;&nbsp;&nbsp; # Do your own stuff from
        here on!</tt><br>
    </blockquote>
    Even here, we're still simplifying a bit, since what you'd find if
    you started filling in code after the label <tt>STARTUP</tt> is
    that your code might execute for a while and then just reset and
    start again at address 04000!&nbsp; What's up with that?&nbsp; Well,
    behind the scenes, the AGC hardware checks performs various checks
    to determine if the computer has somehow frozen up, and of course,
    yaAGC tries to perform whichever of those checks are appropriate as
    well.&nbsp; If it detects any of these conditions, it performs a
    jump to address 04000, just as if a power-up had occurred.&nbsp;
    That's one of the features that lends reliability to the
    device.&nbsp; This restart is known as a GOJAM.&nbsp; I'm not
    totally sure what all of the conditions that could trigger a GOJAM
    are, but <a
      href="https://www.ibiblio.org/apollo/Documents/LUM225-PV_text.pdf">LUMINARY
Memo







      #225</a> contains a handy list of 8 of them.&nbsp; The ones that
    are relevant to software that you yourself write are these:<br>
    <ul>
      <li>Night Watchman — this expects a specific memory location
        (address 067 octal, usually labeled as <tt>NEWJOB</tt>) to be
        tested every so often.&nbsp; If <tt>NEWJOB</tt> isn't tested at
        reasonable intervals, then a GOJAM occurs.&nbsp; (In normal
        mission software, <tt>NEWJOB</tt> is a variable that relates to
        loading jobs into the "executive", and thus it's reasonable to
        expect it not to be ignored by the software.)&nbsp; Thus, you
        need to have some code that periodically reads this location,
        such as a <tt>CS NEWJOB</tt> instruction.</li>
      <li>RUPTLOCK — this check guards against interrupts being disabled
        for too long a period of time, or else for an interrupt service
        routine taking too long before executing its <tt>RESUME</tt>
        instruction to return to the main code.&nbsp; Thus, you must
        make sure that interrupts are usually enabled (and don't occur
        too often or take too long when they do).</li>
      <li>TC TRAP — this check guards against infinite loops of the form
        <tt>TC SELF</tt>.&nbsp; So if your AGC program actually has an
        end point after which it has finished up all of its work, it
        best to end it up with something more complex than an
        instruction to just keep looping at the same address.</li>
    </ul>
    <p>Taking all of that into consideration, here's a minimal framework
      you might use to start building your bare-metal AGC program:<br>
    </p>
    <blockquote>
      <p><tt># Definitions of various registers.<br>
          ARUPT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          EQUALS&nbsp;&nbsp;&nbsp; 10<br>
          QRUPT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          EQUALS&nbsp;&nbsp;&nbsp; 12<br>
          TIME3&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; EQUALS&nbsp;&nbsp;&nbsp;
          26<br>
          NEWJOB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EQUALS&nbsp;&nbsp;&nbsp;
          67 &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; # Location
          checked by the Night Watchman.<br>
        </tt></p>
      <p><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          SETLOC&nbsp;&nbsp;&nbsp; 4000&nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; # The interrupt-vector table.<br>
        </tt></p>
      <p><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #
          Come here at power-up or GOJAM<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          INHINT&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; # Disable interrupts for a moment.<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; # Set
          up the TIME3 interrupt, T3RUPT.&nbsp; TIME3 is a 15-bit<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #
          register at address 026, which automatically increments every<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; # 10
          ms, and a T3RUPT interrupt occurs when the timer<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #
          overflows.&nbsp; Thus if it is initially loaded with 037774,<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; # and
          overflows when it hits 040000, then it will <br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #
          interrupt after 40 ms.<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          CA&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; O37774<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          TS&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; TIME3<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          TCF&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; STARTUP&nbsp;&nbsp;&nbsp; #
          Go to your "real" code.<br>
        </tt></p>
      <p><tt> </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; RESUME&nbsp;&nbsp;&nbsp; # T6RUPT</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; RESUME&nbsp;&nbsp;&nbsp; # T5RUPT</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; DXCH&nbsp;&nbsp; &nbsp;&nbsp; ARUPT
          &nbsp;&nbsp; &nbsp;&nbsp; # T3RUPT</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; EXTEND&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; # Back up A, L, and Q</tt><tt>
          registers<br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; QXCH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QRUPT</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; TCF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          T3RUPT</tt><tt><br>
        </tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; RESUME&nbsp;&nbsp;&nbsp; # T4RUPT</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;
          NOOP</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; RESUME&nbsp;&nbsp;&nbsp; # KEYRUPT1</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; RESUME&nbsp;&nbsp;&nbsp; # KEYRUPT2</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; RESUME&nbsp;&nbsp;&nbsp; # UPRUPT</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; RESUME&nbsp;&nbsp;&nbsp; # DOWNRUPT</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; RESUME&nbsp;&nbsp;&nbsp; # RADAR RUPT</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;
          NOOP</tt><tt><br>
        </tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; RESUME&nbsp;&nbsp;&nbsp; # RUPT10</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; NOOP</tt><tt><br>
        </tt><tt><br>
          # The interrupt-service routine for the TIME3 interrupt every
          40 ms.&nbsp; <br>
          T3RUPT&nbsp;&nbsp; &nbsp;&nbsp; CAF&nbsp;&nbsp;&nbsp;&nbsp;
          O37774&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Schedule another TIME3
          interrupt in 40 ms.<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
TS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;







          TIME3<br>
        </tt></p>
      <p><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #
          Tickle NEWJOB to keep Night Watchman GOJAMs from happening.<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; # You
          normally would NOT do this kind of thing in an
          interrupt-service<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #
          routine, because it would actually prevent you from detecting
          <br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #
          true misbehavior in the main program.&nbsp; If you're
          concerned about<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #
          that, just comment out the next instruction and instead
          sprinkle<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #
          your main code with "CS NEWJOB" instructions at strategic
          points.<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          CS&nbsp;&nbsp;&nbsp; &nbsp; NEWJOB<br>
        </tt></p>
      <p><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #
          If you want to build in your own behavior, do it right here!</tt></p>
      <p><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #
          And resume the main program<br>
          &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;
          DXCH&nbsp;&nbsp;&nbsp;
          ARUPT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Restore A, L, and
          Q, and exit the interrupt<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;







          EXTEND<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
QXCH&nbsp;&nbsp;&nbsp;







          QRUPT<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
RESUME&nbsp;&nbsp;&nbsp;







          &nbsp;&nbsp;&nbsp; </tt><br>
      </p>
      <p><tt><br>
        </tt><tt>STARTUP&nbsp;&nbsp;&nbsp;&nbsp;
          RELINT&nbsp;&nbsp;&nbsp; # Reenable interrupts.</tt></p>
      <p><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #
          Do your own stuff here!<br>
        </tt></p>
      <p><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #
          If you're all done, a nice but complex infinite loop that<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #
          won't trigger a TC TRAP GOJAM.<br>
          ALLDONE&nbsp;&nbsp;&nbsp;&nbsp;
          CS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NEWJOB&nbsp;&nbsp;&nbsp;
          &nbsp; # Tickle the Night Watchman<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          TCF&nbsp;&nbsp;&nbsp;&nbsp; ALLDONE<br>
        </tt></p>
      <p><tt># Define any constants that are needed.<br>
          O37774&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          OCT&nbsp;&nbsp;&nbsp;&nbsp; 37774<br>
          <br>
        </tt></p>
    </blockquote>
    <p>So here you have simple framework with a few empty places in
      which to insert your own code.&nbsp; Not to mention a few
      interrupt vectors (such as the DSKY keypad interrupts, KEYRUPT1
      and KEYRUPT2) that right now do nothing, but which you could
      imagine might be very helpful.<br>
    </p>
    <p>What might the functionality for reading DSKY keystrokes look
      like?&nbsp; Note that <a
        href="developer.html#Table_of_IO_Channels">info about the i/o
        channels pertaining to the DSKY are on the developer page</a>.&nbsp;
Perhaps







      you'd use the KEYRUPT1 interrupt-service routine to read the input
      channel containing the DSKY keycode, and then store that keycode
      in a variable.&nbsp; Your main program loop might periodically
      check that variable to see it it contains anything, and then might
      output something to the DSKY so you'd know it had been
      detected.&nbsp; For example, it might toggle the DSKY's COMP ACTY
      lamp every time there was a new keycode detected.<br>
    </p>
    <blockquote>
      <p><tt># Here's what the allocation of the variable to hold the
          keycode might look like.<br>
          # Plus, a variable that tells if COMP ACTY is currently on or
          off.<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;
          SETLOC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 68<br>
          KEYBUF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ERASE&nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; # 040
          when empty, 0-037 when holding a code<br>
          CASTATUS&nbsp;&nbsp;&nbsp; ERASE&nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; # 0
          if COMP ACTY off, 2 if on.<br>
        </tt></p>
      <p><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .<br>
        </tt></p>
      <p><tt># Here's what the KEYRUPT1 interrupt-vector table entry
          might look like.<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          DXCH&nbsp;&nbsp; &nbsp;&nbsp; ARUPT &nbsp;&nbsp; &nbsp;&nbsp;
          # KEYRUPT1</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; EXTEND&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; # Back up A, L, and Q</tt><tt>
          registers<br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; QXCH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QRUPT</tt><tt><br>
        </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; TCF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          KEYRUPT1</tt></p>
      <p><tt> </tt><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; .<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .<br>
        </tt></p>
      <p><tt># Here's what the actual interrupt-service code might look
          like.<br>
          KEYRUPT1&nbsp;&nbsp;&nbsp; EXTEND<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          READ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 15&nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; # Read the DSKY keycode input
          channel<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          MASK&nbsp;&nbsp; &nbsp;&nbsp; O37&nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Get rid of all but lowest 5
          bits.<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          TS&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          KEYBUF&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; # save the keycode for
          later.</tt><tt><br>
          &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;
          DXCH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          ARUPT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Restore A,
          L, and Q, and exit the interrupt<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;







          EXTEND<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
QXCH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;







          QRUPT<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
RESUME&nbsp;&nbsp;&nbsp;







          &nbsp;&nbsp;&nbsp; </tt></p>
      <p><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .<br>
        </tt></p>
      <p><tt># Here's what it might look like in the main code.<br>
          STARTUP&nbsp;&nbsp;&nbsp;&nbsp; RELINT<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #
          Initialization<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          CA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          NOKEY&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; # Clear the
          keypad buffer variable<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          TS&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          KEYBUF&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; # to initially
          hold an illegal keycode.<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          CA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ZERO<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          TS&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; CASTATUS<br>
        </tt></p>
      <p><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .<br>
        </tt></p>
      <p><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #
          Occasionally check if there's a keycode ready, and toggle <br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #
          DSKY COMP ACTY if there is.&nbsp; Presumably this is inside of
          a <br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #
          loop.<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          CA&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; NOKEY<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          EXTEND<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          SU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          KEYBUF&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; # Acc will now be
          zero if no key, non-zero otherwise<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          EXTEND<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          BZF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EMPTY<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          CA&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; NOKEY<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          TS&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          KEYBUF&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; # Mark keycode
          buffer as empty.<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          CA&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          CASTATUS&nbsp;&nbsp;&nbsp; &nbsp; # Toggle COMP ACTY.<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          EXTEND<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          BZF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CAOFF<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          CA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ZERO<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          TCF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CATOGGLE<br>
          CAOFF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CA&nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; TWO<br>
          CATOGGLE&nbsp;&nbsp;&nbsp;
          TS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CASTATUS<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          EXTEND<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          WRITE&nbsp;&nbsp;&nbsp;&nbsp; 11&nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; # Write to the DSKY
          lamps<br>
          EMPTY&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; NOOP<br>
        </tt></p>
      <p><tt>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .<br>
        </tt></p>
      <p><tt># Constants<br>
          ZERO&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          OCT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0<br>
          TWO&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;
          OCT&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; 2<br>
          O37&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;
          OCT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 37&nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; # Mask with lowest 5
          bits set.<br>
          NOKEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          OCT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 40<br>
        </tt></p>
    </blockquote>
    <p><img src="piPeripheral.jpg" alt="" width="290" height="336"
        align="right">With this, you actually have an AGC program that
      does something, and does it both visibly and testably ... if not
      very excitingly.<br>
    </p>
    <p>A slightly sleeker form of this code, called <a
href="https://github.com/virtualagc/virtualagc/blob/master/piPeripheral/piPeripheral.agc">piPeripheral.agc,
which







        can be assembled with yaYUL and actually works if it is run in
        the AGC simulator, can be found in our GitHub repository</a>.&nbsp;
Actually,







      the code in GitHub is not <i>merely</i> a cleaned-up form of the
      code above, but in fact implements processing of the
      current-timestamp information the sample peripheral program
      piPeripheral.py provides in the newly-minted AGC input channels
      040-042.&nbsp; (See the end of the preceding section.)&nbsp; What
      piPeripheral.agc does with that information (which is a packed
      form of the date and time) is to:<br>
    </p>
    <ul>
      <li>Unpack the data into separate year, month, day, hour, minute,
        and second fields.</li>
      <li> Output the unpacked data fields in the newly-allocated AGC
        output channels 043-050.</li>
      <li>Display the data on the DSKY.</li>
    </ul>
    <p>You can actually see what this looks like on a simulated DSKY in
      the picture to right.&nbsp; What you see there is:<br>
    </p>
    <ul>
      <li>The year (2017) in DSKY register R3 (the bottom 5-digit area).</li>
      <li>The month (12) and the day (09) in DSKY register R2.</li>
      <li>The hour (06) and minute (19) in DSKY register R1.</li>
      <li>The seconds (10) in the NOUN area.</li>
    </ul>
    <p>The piPeripheral.py program will have generated this data
      according to the preference settings on the compuer on which
      you're running it, which in my case is the U.S. CST time-zone ...
      so yes, I was doing this at around 6 in the morning, local time,
      on a Saturday.&nbsp; Yawn!&nbsp; I should be paid more (than the
      $0 I currently get) for doing this lousy job.&nbsp; :-)<br>
    </p>
    <p>At any rate, assuming one has written such a custom AGC program,
      a necessary step before being able to run it in the AGC simulator
      is to assemble it with the yaYUL assembler.&nbsp; Exactly how to
      find the assembler depends on the particular setup being used, but
      assuming you can find it (or better yet, have it in the "PATH"),
      assembly is a snap.&nbsp; But suppose, for example, that you
      simply want to assemble piPeripheral.agc; assuming you've retained
      the same directory setup as in GitHub, and have built the normal
      Virtual AGC software too, you could do something like the
      following without having to worry about path settings:<br>
    </p>
    <blockquote>
      <p><tt>cd virtualagc/piPeripheral</tt><tt><br>
        </tt><tt>../yaYUL/yaYUL piPeripheral.agc</tt><br>
      </p>
    </blockquote>
    The result (if there were no errors, and hopefully there wouldn't be
    for an unmodified piPeripheral.agc) would be the executable file
    piPeripheral.agc.bin.&nbsp; If there were assembly errors such as
    syntax problems or unallocated variables, of course, then you have
    to fix them ... a topic on which it's difficult to offer any general
    advice other than to start with a small program that assembles
    perfectly and slowly work towards having a larger program.&nbsp; <br>
    <p>Once the program is assembled, it can be run in the AGC
      simulator.&nbsp; This is again a tricky topic, since there are a
      variety of ways in which it can be done, and a variety of possible
      system configurations.&nbsp; What you would do on a desktop PC is
      undoubtedly not the same thing you'd do on the 3D-printed DSKY
      mentioned earlier.&nbsp; However, to just do it from a command
      line within our software tree as downloaded from GitHub and
      successfully built from source, in Linux you could do the
      following.<br>
    </p>
    <blockquote>
      <p><tt># Start up the AGC simulator with the custom AGC program,
          in the background, and discard all messages from it.<br>
          cd virtualagc/yaAGC</tt><tt><br>
        </tt><tt>./yaAGC --core="../piPeripheral/piPeripheral.agc.bin"
          --port=19697 --cfg="../yaDSKY/src/LM.ini" &amp;&gt;/dev/null
          &amp;<br>
          # Start up the DSKY simulator in the background and discard
          all messages from it.<br>
          cd ../yaDSKY2</tt><tt><br>
        </tt><tt>./yaDSKY2 --cfg="../yaDSKY/src/LM.ini" --port=19698
          &amp;&gt;/dev/null &amp;<br>
          # Start up the custom peripheral device, in the foreground,
          and don't discard its messages.&nbsp; You might need<br>
          # to install some extra Python modules, such as "sudo pip3
          install argparse", if this fails. <br>
          cd ../piPeripheral</tt><tt><br>
        </tt><tt>./piPeripheral.py --port=19699 --time=1<br>
          # Now that the custom peripheral has been terminated, clean up
          the other programs we've started.<br>
          killall yaAGC yaDSKY2<br>
        </tt></p>
    </blockquote>
    <p>On Mac OS, I think it would be a bit trickier than what I'm
      written, since I don't think that yaDSKY2 as started this way
      would actually accept any keypress events; I'm not sure quite how
      to do it properly, though.&nbsp; On Windows, you would have to use
      backslashes ('\') in places of the forward slashes if used here
      ('/'); also, I don't know that using '&amp;' to put the programs
      into the background would work, or that "killall" would be
      available for killing those programs afterward, so you might want
      to run the various programs all in the foreground, in separate
      command-line consoles.&nbsp; But obviously, there's a way to do
      it, even if I'm too personally lazy to figure it out just
      yet.&nbsp; If anyone just wants to inform me of the correct
      detailed way of doing things on Mac OS X or Windows, I'd be happy
      to include that info here.<br>
    </p>
    <blockquote>
      <p><tt> </tt></p>
    </blockquote>
    <hr style="width: 100%; height: 2px;">
    <h2><a name="Programming_for_the_AGC_Operating"></a>Programming for
      the AGC "Operating System"</h2>
    <p><font size="+1"><b><i>This section is under construction.&nbsp;
            Beware!</i></b></font><br>
    </p>
    There are really two distinct ways of writing so-called "<a
      moz-do-not-send="true"
      href="https://en.wikipedia.org/wiki/Embedded_software">embedded
      software</a>" intended to run in stand-alone devices like the
    AGC.&nbsp; One is the "bare-metal" approach described above, in
    which the software you are writing is the only software residing on
    the computer, and thus must itself directly handle any interactions
    with peripheral devices like the DSKY.&nbsp; While interacting with
    peripheral devices can sometimes be complex, bare-metal programming
    is generally relatively simple for the person coding the software,
    since all he/she needs to understand is how the CPU instructions
    work and what the interface of the CPU to the peripheral device is
    like.&nbsp; No pesky understanding of the other software installed
    on the embedded device is needed, since there is no other software
    installed.<br>
    <br>
    However, the use of bare-metal programming for the AGC is pretty
    restricted in scope, because you generally want to install programs
    on the AGC so that they can be used by the <i>astronauts</i>, and
    the astronauts' AGCs are going to have flight software like <a
      moz-do-not-send="true" href="Luminary.html">LUMINARY</a> or <a
      moz-do-not-send="true" href="Colossus.html">COLOSSUS</a> installed
    on them.&nbsp; Any additional application you want to write would
    therefore have to fit seamlessly into whatever flight software is
    already installed ... which is a hassle!&nbsp; On the other hand,
    this has some great advantages too, since you can then think of
    LUMINARY or COLOSSUS (or any other AGC flight software) as being an
    "operating system" (with 40-50 preinstalled apps running under it)
    that provides basic services to your application, such as:<br>
    <ul>
      <li>A uniform method of dealing with low-level i/o for the DSKY.</li>
      <li>A uniform man-machine interface for the astronauts.<br>
      </li>
      <li>Multitasking.</li>
      <li>Real-time operation.</li>
      <li>Error recovery.</li>
      <li>etc.<br>
      </li>
    </ul>
    <blockquote>
      <p><font size="-1"><b>Aside:</b>&nbsp; For the AGC, there's
          actually a third approach that's a hybrid of the bare-metal
          and operating-system approaches, in that it's possible to
          request the operating system to periodically run a specified
          task via the AGC's hardware timers that the operating system
          itself is already controlling.&nbsp; That's done via the
          idling program's (P00) "request waitlist" (VERB 31)
          facility.&nbsp; This hybrid approach is available, I think,
          principally for activating so-called Erasable Memory Programs
          (EMPs) that are uploaded supplements for the released programs
          stored in unalterable core memory.&nbsp; I won't cover any of
          that here, but <a moz-do-not-send="true"
href="Documents/R-567-GSOP-Luminary1E-Section7-ErasableMemoryPrograms.pdf">you







            can read about it elsewhere</a>.</font><br>
      </p>
    </blockquote>
    Unfortunately, after some fairly-diligent searching in our document
    library, I find no convenient tutorial or how-to on writing apps
    operating under the AGC's multitasking executive.&nbsp; So in this
    section, I try to cobble together a mini-tutorial on the
    subject.&nbsp; Alas, I'm no expert, so don't trust my explanation to
    be either 100% complete or correct, and there may be errors in my
    meanderings.&nbsp; Feel free to let me know when I've strayed from
    the facts. &nbsp; I'll confine my remarks to the Block II AGC,
    though I'm sure that similar considerations apply to Block I
    systems.&nbsp; (I'm only finite, after all, and these days maybe
    even less so!&nbsp; If I ever write an autobiography, perhaps I'll
    title it <i>Less Than Finite</i>.)<br>
    <blockquote><font size="-1"><b>Important Note:</b>&nbsp; An idea
        that I may have occasionally promoted myself is providing a new
        program that's a game, for the purpose of providing the
        astronauts with at least a little recreation.&nbsp; There's an
        interesting drawback to that plan, a drawback which it's likely
        that many other ideas for additional AGC apps may have as
        well:&nbsp; When the operating system is present, you don't have
        arbitrary control over what's displayed on the DSKY, nor
        arbitrary access to the keystrokes received by the DSKY
        keypad.&nbsp; Rather, the appearance, interpretation, and timing
        of all of these are controlled by the operating system's PINBALL
        GAME BUTTONS AND LIGHTS program, and PINBALL works with the
        display and keyboard entirely under the overarching concept of
        PROGs, VERBs, and NOUNs.&nbsp; For example, suppose you wanted
        to provide a Tic Tac Toe game, <a moz-do-not-send="true"
          href="https://github.com/NeilFraser/AGC-code/tree/main">something







          which is perfectly possible in bare-metal programming</a>
        where you have unfettered direct access to all DSKY facilities;
        the hyperlinked Tic Tac Toe game freely displays numbers on the
        DSKY, and accepts arbitrary combinations of keypresses +, -, and
        0-9.&nbsp; Such a game would have to have a very different user
        interface if working under the operating system, in which the
        VERT or NOUN keys would have to be used liberally as well.</font><br>
    </blockquote>
    Nice though aesthetically-horrifying documentation of the
    multitasking executive system itself can be found in <a
      moz-do-not-send="true" href="hrst/archive/1709b.pdf#page=63">Section







      II of the <i>LM Primary Guidance Navigation and Control System
        Study Guide</i></a>.&nbsp; Indeed, if you can stomach it, it
    would be worthwhile looking through the entire study guide before
    proceeding, because it contains a lot of useful details and context
    that I'm not going to cover below.&nbsp; Note, though, that the
    study guide was released in January 1967, and some of the
    information in it, however useful, is not necessarily 100% complete
    or correct in detail for later versions of AGC flight
    software.&nbsp; And I wish we had a <i>much</i> cleaner version of
    the document for you than our only-marginally-readable one, but we
    don't.<br>
    <blockquote><font size="-1"><b>Aside:</b>&nbsp; <a
          moz-do-not-send="true"
href="https://ead.lib.virginia.edu/vivaxtf/view?docId=oai/VT/repositories_2_resources_2187.xml&amp;chunk.id=&amp;toc.depth=1&amp;toc.id=&amp;brand=default#subseries3">The







          Virginia Tech University Libraries, in the James J. Avitabile
          Papers collection</a>, seem to have a clean copy of the
        document, in a more-current version than ours.&nbsp; Indeed,
        VT's collection seems also to have the corresponding CM
        document.&nbsp; Alas, I don't know any convenient way to my
        hands on either of these documents for online posting.&nbsp;
        Anyone wishing to perform a public service and with the stamina
        to wade through the system should get them for us!&nbsp; Here
        are the relevant excerpts from the VT finding aid (<font
          color="#cc0000">highlighting</font> mine):<br>
      </font></blockquote>
    <blockquote>
      <blockquote><font size="-1">box-folder 17 folder: 2-4<br>
          Lunar Module Primary Guidance and Navigation and Control
          System Student Study Guide<br>
          1967<br>
          &nbsp;&nbsp;&nbsp;&nbsp; Scope and Content<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Content<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;







          Familiarization Course (Revision A), Jan. 20, 1967 (2 folders)<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;







          System Mechanization, Jan. 27, 1967 (5 folders)<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;







          <font color="#cc0000">Computer Utility Programs (Revision A),
            Apr. 5, 1967 (3 folders)</font><br>
          box-folder 18 folder: 1-2<br>
          Command Module Primary Guidance and Navigation and Control
          System Student Study Guide<br>
          1966<br>
          &nbsp;&nbsp;&nbsp;&nbsp; Scope and Content<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Content<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;







          Familiarization Course (Revision A), Feb. 15, 1967 (3 folders)<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;







          <font color="#cc0000">Computer Utility Programs, Mar. 2, 1967
            (3 folders)</font></font><br>
      </blockquote>
    </blockquote>
    By the way, in the sections that follow, I've provided links to
    LUMINARY 99/1 (Apollo 11) source code whenever I want to refer to
    operating-system behavior, but that choice is rather arbitrary and
    the behavior of your chosen AGC software version could differ in
    some details.<br>
    <h3>Step 1:&nbsp; Choose the Operating System and Fixed-Memory Bank<br>
    </h3>
    Or in other words, choose the particular version of the AGC flight
    software into which you want to integrate your application.&nbsp; <br>
    <br>
    The choice is important primarily because mature versions of the
    flight software already occupy most of the memory in all of the
    AGC's memory blocks, so there may not be enough continuous space in
    any given memory bank to store your new program.&nbsp; That forces
    you either to eliminate preexisting applications in the flight
    software, or else to split up your new applications into smaller
    chunks, distributed among several AGC memory banks, and to jump back
    and forth between them as needed.&nbsp; Which you can certainly do,
    even though it messes up the elegance of your code.&nbsp; Of course,
    if you already insist that you want to put your application into a
    specific environment like the Apollo 11 Lunar Module, then you have
    no real choice:&nbsp; You simply have to start with Luminary099 as
    your operating system and live with the consequences.&nbsp; But
    those consequences are severe, since the "emptiest" memory bank in
    Luminary099 has only 51 available words left out of 1024 total. <br>
    <br>
    If you're not so picky, you have more choices.&nbsp; Speaking
    generally, earlier versions of the flight software will have more
    unused (and hence more available) memory in them than later versions
    will.&nbsp; For example, bank 15 of the early flight software
    SUNDANCE 306 (a predecessor to LUMINARY) has 280 words of contiguous
    space available for your app, out of 1024 total, while bank 05 has
    231 available words, and so on.&nbsp; These may sound like
    pathetically-small numbers to you, but as you saw in the paragraph
    above, they are luxuriously large amounts of memory in the AGC
    world.<br>
    <br>
    At this point you should also choose the fixed-memory bank in which
    you want to store the code for your app.<br>
    <br>
    Whichever preexisting software you choose as your operating system,
    though, be sure to make a copy of it before making any modifications
    to it:&nbsp; Copy the entire folder from the AGC source tree, and
    give it an entirely new name, such as MYAPP.&nbsp; Note that while
    you can obviously place your new source-code folder anywhere you
    like, the instructions for several of the steps described below
    (specifically, steps 6 and 8) assume that you have put it in the
    Virtual AGC source tree, as a sibling folder at the same level as
    the AGC version you started with, so if you locate your source-code
    folder elsewhere, you may need to adapt those instructions when you
    get down to them.<br>
    <h3>Step 2:&nbsp; Choose a 2-Digit "Major Mode" to Associate With
      the Application You Want to Write<br>
    </h3>
    <blockquote>
      <p><font size="-1"><b>Note:</b> Step 5 below describes how to <i>automatically</i>
          start your app when the AGC starts or restarts.&nbsp; Steps 2
          and 3, I believe, are relevant to the situation in which you'd
          like the astronaut to be able to manually start your app via
          the commonly-used method of </font><font size="-1"><tt>VERB
            37</tt></font><font size="-1"> ("change major mode") on the
          DSKY.&nbsp; If you want only to have your app autostart, then
          perhaps you can skip Steps 2 and 3, and proceed directly to
          Step 4 below.&nbsp; Even if you skip these steps, I think it
          should still be possible to start your app from the DSKY,
          using the more-obscure and more-irksome process of getting
          into idling mode (</font><font size="-1"><tt>VERB 37 ENTR 00
            ENTR</tt></font><font size="-1">), starting a "request
          executive" operation (</font><font size="-1"><tt>VERB 30 ENTR</tt></font><font
          size="-1">), and then supplying low-level characteristics of
          the multitasking job you want to start (</font><font size="-1"><tt>NOUN







            26</tt></font><font size="-1">), such as the job priority,
          whether a VAC is needed, the starting address of your app, and
          the fixed/erasable memory banks associated with your
          app.&nbsp; As it happens, these are all of the same kinds of
          data you need for Step 3 below, so there may not be much
          advantage in skipping past it.&nbsp; An advantage of this
          alternate approach is that (I think!) it allows your app's
          code to be located in the memory superbanks 40-43, whereas the
          approach I outline below does not.&nbsp; Anyway, you can read
          more about this alternative method of starting your app from
          the DSKY <a moz-do-not-send="true"
href="Documents/R-567-GSOP-Luminary1E-Section7-ErasableMemoryPrograms.pdf">here</a>.</font><br>
      </p>
    </blockquote>
    Each app ("program", "major mode", "MM") installed in the operating
    system is identified by a unique two-digit decimal number that's
    used to activate the app.&nbsp; For example, to activate the idling
    routine (P00), the astronaut keys <tt>VERB 37 ENTR 0 0 ENTR</tt>
    into the DSKY, at which point the DSKY displays that the "PROG" is
    00 to indicate that the idling routine is currently active.&nbsp; If
    your new app is ever going to be activated by the astronaut, it too
    must be associated with one of these 2-digit code numbers, different
    from all of the preexisting apps.<br>
    <br>
    The program comments in the AGC flight-software source code tend to
    provide detailed explanations for many types of numerical codes used
    in the software, such as the 2-digit numerical codes for "VERBS" and
    "NOUNS", and the 5-digit (octal) codes used for errors.&nbsp; (Just
    look in the code section we call <a moz-do-not-send="true"
      href="listings/Luminary099/ASSEMBLY_AND_OPERATION_INFORMATION.agc.html">ASSEMBLY_AND_OPERATION_INFORMATION</a>.)&nbsp;





    Unfortunately, the same cannot be said for the 2-digit numerical
    codes associated with the individual programs.&nbsp; How can we fill
    in this gap in the documentation provided by the program
    comments?&nbsp; There is generally a numeric table of the 2-digit
    program codes that's embedded in the source code, even if
    unfortunately without any detailed explanation of those codes in the
    program comments.&nbsp; For any of the flight software versions
    (SUNDANCE, LUMINARY, COLOSSUS, COMANCHE, ARTEMIS, SKYLARK), just
    look for the symbol <tt>FCADRMM1</tt> in the code section <a
      moz-do-not-send="true"
      href="listings/Luminary099/FRESH_START_AND_RESTART.agc.html">FRESH_START_AND_RESTART</a>.&nbsp;





    For example, for LUMINARY 69, we find that the following 2-digit
    program codes are already used:&nbsp; 00, 06, 12, 20, 21, 22, ...,
    79.<br>
    <br>
    Note that code 00 is <i>always</i> associated with the so-called
    idling program, but it never explicitly appears in the hard-coded
    tables.&nbsp; So in the LUMINARY 69 example just seen, the
    hard-coded tables only include major modes 06, 12, ..., 79.<br>
    <br>
    Just having these tables of numerical codes, without their
    interpretations, may be adequate for you, since your main purpose in
    looking at them is to choose an unused one to associate with your
    new app.&nbsp; But realize that back during the Apollo era, related
    apps generally were often (always?) chosen to have related
    program-number codes.&nbsp; So if you want to preserve this
    particular element of authenticity then you should choose an <i>appropriate</i>
    numerical range for your app's 2-digit code as well, rather than
    just picking the first unused 2-digit code that catches your
    fancy.&nbsp; To understand the interpretations of the 2-digit codes
    you can, of course, search through the AGC source code for each of
    the previously-assigned 2-digit program codes, and individually read
    the program comments for each one.&nbsp; But fortunately, for <i>some</i>
    AGC flight-software versions, external documents in our document
    library provide more-efficient way to extract this information:<br>
    <ul>
      <li><a moz-do-not-send="true" href="links2.html#ReferenceCards">Documents







          in our library's "Quick-Reference Cards, Data Cards, Cue
          Cards" section</a> <i>sometimes</i> include useful lists of
        program codes.&nbsp; Sometimes they do not.&nbsp; For example, <a
          moz-do-not-send="true"
href="https://www.ibiblio.org/apollo/Documents/Apollo15_Colossus3_CMC_Data_Cards.pdf#page=7">here







          are such cards</a> for the ARTEMIS flight software (Apollo
        15-17 Command Modules), and <a moz-do-not-send="true"
href="https://www.ibiblio.org/apollo/Documents/apollo_15_lgc_data_cards.pdf#page=12">here







          are the corresponding cards</a> for the Apollo 15-17 (Lunar
        Modules) LUMINARY program.</li>
      <li><a moz-do-not-send="true" href="links2.html#GSOPs">Documents
          in our library's "Guidance System Operations Plans (GSOP)"
          section</a> generally do contain useful lists of program
        codes, often near the beginning of section 4.4.</li>
      <li><a moz-do-not-send="true" href="links2.html#MathFlow">Documents







          in our library's "Math Flow" section</a> — particularly the
        so-called "Programmed Guidance Equations" documents (search for
        the symbol <tt>MODREG</tt>) — generally have useful lists.<br>
      </li>
    </ul>
    <p>Unfortunately, we have only a limited selection of these kinds of
      documents in the library, and certainly don't have them for every
      mission you might choose to use as your "operating system", so you
      may still have to resort to determining the interpretations of the
      2-digit program codes the hard way.<br>
    </p>
    <h3>Step 3:&nbsp; Add Your New App to the List of Major Modes</h3>
    In the FRESH_START_AND_RESTART section of the flight software, there
    are either 2 tables or 3 tables that define the list of major
    modes.&nbsp; Each table has the same number of entries, namely an
    entry for each program other than P00, and are ordered in <i>descending</i>
    value of 2-digit program code.&nbsp; You have to modify each of
    these tables, in corresponding locations, to include your new
    app.&nbsp; Explanations of the values in these tables is covered by
    the accompanying program comments in the source code, but my own
    summary follows.<br>
    <p>For AGC software versions other than ARTEMIS or SKYLARK, there
      are 3 tables:<br>
    </p>
    <ul>
      <li><tt>FCADRMM1</tt>:&nbsp; This table contains an <tt>FCADR</tt>
        for each program in the table.&nbsp; <tt>FCADR</tt> is an
        assembly-language "pseudo-op".&nbsp; It stands for Fixed Bank
        Complete Address, and converts the memory-bank-oriented
        fixed-memory space of the AGC — normally consisting of a a
        fixed-memory bank number (5 bits), and a word-offset into the
        bank (10 bits) — into a continuous 15-bit address space.&nbsp;
        One implication of this is that your app (or at least its entry
        point) must reside in fixed-memory banks 00 through 37 (octal),
        and cannot reside in any of the so-called "superbanks" 40
        through 43.&nbsp; If your application starts at (say) label <tt>MYAPP</tt>,
        then the appropriate thing to insert into the table would be <tt>FCADR







          MYAPP</tt>.<br>
      </li>
      <li><tt>PREMM1</tt>: The values in this table consist of
        bit-fields <tt>PPPPPEEEMMMMMMM</tt>.&nbsp; Here, <tt>PPPPP</tt>
        is the job priority — remember that the operating system will
        multitask your app with all other programs it's running at the
        same time —, ranging from 0 (lowest priority) to 31 (highest
        priority).&nbsp; <tt>EEE</tt> is the erasable-memory bank
        number (0 through 7) that's active while your app is awake, and
        is the bank where all of the variables for your app should be
        allocated via the <tt>ERASE</tt> pseudo-op.&nbsp; <tt>MMMMMMM</tt>
        is for the 2-digit program code (00-99 decimal, with values
        100-127 unused) associated with your app.<br>
      </li>
      <li><tt>DNLADMM1</tt>: This table specifies the downlinked
        telemetry list which is output while your app is in use.&nbsp;
        Unless you create a new telemetry-list definition (in the
        section DOWNLINK_LISTS), your choices are limited by the
        preexisting telemetry-list definitions, none of which, of
        course, will output any of the new variables you've created for
        your app.&nbsp; In this situation, it doesn't really matter
        which of the preexisting telemetry lists are output, and you can
        simply choose to duplicate any one of them that's already listed
        in the table.&nbsp; (If for some reason you do want to output
        your own custom telemetry list, then you'll have to create it
        yourself and add a label for it in the table.&nbsp; That's more
        than I really want to discuss here, so I'll just point out that
        you can duplicate any of the lists you find within
        DOWNLINK_LISTS, give it a new symbolic name, and then modify
        some of its entries to point to your new variables.&nbsp; That's
        assuming that there's enough available memory to do so!&nbsp; <a
          moz-do-not-send="true" href="yaTelemetry.html#yaTelemetry">Read







          this</a> to understand additional subtleties, particularly the
        I.D. word and Sync Bits that head up each downlist.&nbsp; Note
        that simulation software like the <b>VirtualAGC</b> program is
        only aware of preexisting downlists, and will not know how to
        print your newly-defined telemetry in a pretty fashion, so
        defining a new downlist may have limited utility.)<br>
      </li>
    </ul>
    <p>Additionally, at label <tt>NOV37MM</tt>, there is a count of the
      number of entries in the tables, which is the number of major
      modes minus 1 (for the ubiquitous mod 00).&nbsp; So when you add
      entries to the tables listed above to include your new app, you
      have to increment the value at <tt>NOV37MM</tt> by 1.<br>
    </p>
    <p>Note that these steps are inverted if/when you choose to <i>delete</i>
      existing major modes in order to recover memory.&nbsp; I.e.,
      entries for the programs you remove must also be deleted from the
      three tables, and <tt>NOV37MM</tt> must be decremented for each
      program removed.<br>
    </p>
    <p>For ARTEMIS or SKYLARK, on the other hand, job priorities are
      omitted from table <tt>PREMM1</tt>, which which saves enough bits
      to allow tables <tt>PREMM1</tt> and <tt>DNLADMM1</tt> to be
      consolidated.&nbsp; This saves memory, but makes it harder for you
      to define your own custom telemetry downlists, if you desired to
      do so.&nbsp; The value for <tt>NOV37MM</tt> is figured
      automatically by the assembler, so you do not have to maintain it.<br>
    </p>
    <ul>
      <li><tt>FCADRMM1</tt>:&nbsp; Same as before.<br>
      </li>
      <li><tt>PREMM1</tt>: The values in this table consist of
        bit-fields <tt>DDD00EEEMMMMMMM</tt>.&nbsp; Here, <tt>DDD</tt>
        specifies the downlinked telemetry list which is output while
        your app is in use: 0 is the COAST AND ALIGN downlist, 1 is the
        ENTRY downlist, 2 is the RENDEZVOUS downlist, 3 is the POWERED
        FLIGHT downlist, and 4 is the P22 downlist.&nbsp; <tt>EEE</tt>
        and <tt>MMMMMMM</tt> are the same as before.<br>
      </li>
      <li><tt>DNLADMM1</tt>:&nbsp; No such table!<br>
      </li>
    </ul>
    <h3>Step 4:&nbsp; Add the Source Code for Your App Into the
      Operating System<br>
    </h3>
    <p>You can add the new code directly into an existing source-code
      file for your chosen "operating system", or else you can create a
      new AGC source-code file and store it in the same folder with all
      of the other source files for your chosen operating system.&nbsp;
      If you do want to create a new source-code file, as I imagine is
      probably the case, be sure to add it in MAIN.agc to all of the
      other source-code files comprising the operating system.&nbsp; Add
      the new file to the <i>end</i> of the list of source-code files
      (in MAIN.agc), to insure that the assembled forms of the
      preexisting files retain similar addressing to what they had
      before your new code was added, rather than all being displaced
      upward in memory to accommodate the new code.&nbsp; (They may or
      may not be somewhat displaced anyway, due to adding new entries in
      the major-mode tables as described above, or other modifications
      described below.)<br>
    </p>
    <p>What are the characteristics you need to build into your app's
      source code to exist harmoniously in the operating system?&nbsp;
      That's what the subsections below cover.<br>
    </p>
    <h4>Lead-In<br>
    </h4>
    <p>Your new source code should begin by telling the assembler to
      place the code in the memory banks you've chosen.&nbsp; For the
      sake of discussion, let's suppose that:<br>
    </p>
    <ul>
      <li>Your app is called <tt>MYAPP</tt></li>
      <li>It's supposed to reside in fixed-memory bank 15.&nbsp; (Recall
        that Step 1 above required that you choose a fixed-memory bank.)<br>
      </li>
      <li>Its variables are supposed to reside in erasable-memory bank
        4.&nbsp; (Recall that in Step 3 above, you needed to select an
        erasable-memory bank in the <tt>PREMM1</tt> table.)<br>
      </li>
    </ul>
    <p>Simple-minded code for your app's lead-in might look like this:<br>
    </p>
    <pre>        BANK 15<br>	EBANK= 4<br>MYAPP   ...<br>	.<br>	.<br>	.<br></pre>
    <p>I call this code "simple-minded", because in practice you might
      find that it's better practice to use symbolic names for the
      memory banks, rather than hard-coding the constants 15 and 4, and
      there are additional pseudo-ops than just <tt>BANK</tt> and <tt>EBANK=</tt>
      to accomplish this.&nbsp; But simple-minded way is certainly a
      valid approach.<br>
    </p>
    <h4>Basic Assembly Language vs Interpreter Language</h4>
    <p>The code for your app can use either basic assembly language or
      interpreter language, or intermix them.&nbsp; Note that each job
      being multitasked by the <a moz-do-not-send="true"
        href="listings/Luminary099/EXECUTIVE.agc.html">EXECUTIVE</a> —
      including your own app — is assigned its own separate "vector
      accumulator" (VAC) for use with interpreted code.&nbsp; In other
      words, interpretive code in your app has a VAC that does not
      conflict with the VAC of other running jobs.<br>
    </p>
    <h4>Cooperative Multitasking</h4>
    <p>Multitasking in the AGC "operating system" is cooperative rather
      than preemptive.&nbsp; In other words, the EXECUTIVE doesn't
      successively give competing jobs time-slices for execution and
      forcibly change control from one job to another when those
      time-slices are complete.&nbsp; Apparently, time-slices do not
      exist as such.&nbsp; Rather, each job (such as your app) must
      periodically check whether a job of a higher priority is pending,
      and meekly return control the EXECUTIVE if so.&nbsp; But if no
      higher-priority job is pending, the currently-executing job can
      just keep going as long as it likes without surrendering to the
      executive.<br>
    </p>
    <blockquote>
      <p><font size="-1"><b>Aside:</b>&nbsp; The operating system's
          multitasking scheme should not be confused with low-level
          interrupt-driven software that performs operations such as
          servicing hardware timers, asynchronously getting keystrokes
          from the DSKY or uplink, and so on.&nbsp; CPU interrupt
          servicing is a completely separate mechanism from
          operating-system multitasking.&nbsp; But for example, an
          interrupt-service routine operating from a CPU timer could
          schedule a high-priority multitasked job, which would later
          cause a lower-priority multitasked job to relinquish control
          to the EXECUTIVE.</font><br>
      </p>
    </blockquote>
    <p>A pending job of higher priority is communicated to the
      currently-executing job via the <tt>NEWJOB</tt> variable, which
      will have either the value +0 (to indicate that there is no
      higher-priority job) or a value &gt;0 (to indicate that there is
      indeed a higher-priority job pending).&nbsp; Negative (or -0)
      values never appear.&nbsp; While there are a number of ways to
      respond to these conditions, a typical technique is for each job
      to periodically use the code<br>
    </p>
    <pre>	# If in the midst of a block of basic assembly-language code.<br>	CCS	NEWJOB<br>	TC	CHANG1<br></pre>
    <p>or else<br>
    </p>
    <pre>	# If in the midst of a block of interpreter-language code.<br>	CCS	NEWJOB<br>	TC	CHANG2<br></pre>
    When the EXECUTIVE eventually returns control to your app, execution
    will resume at the location following the <tt>TC CHANG<i>x</i></tt>
    instruction.<br>
    <h4>Voluntary Sleep<br>
    </h4>
    <p>There are conditions under which your app may wish to voluntarily
      return control to the EXECUTIVE and put itself to sleep.&nbsp; For
      example, it might want to wait on i/o without hogging CPU cycles
      that could profitably be used by other jobs.&nbsp; Your app does
      this using code similar to the following:<br>
    </p>
    <pre>	CAF	... address at which to reenter at next time-slice ...<br>	TCF	JOBSLEEP<br></pre>
    or <br>
    <pre>	CAF	... address at which to reenter at next time-slice ...
	TC	JOBSLEEP<br></pre>
    Once your app is asleep, however, it will no longer receive
    time-slices and hence will no longer execute until some code
    external to it wakes it up by means of a call to <tt>JOBWAKE</tt>.
    <br>
    <h4>Ending Your App<br>
    </h4>
    <p>If your app isn't intended to run forever, then eventually you'll
      want your app to terminate itself and receive no additional time
      slices.&nbsp; Your app does this like so:<br>
    </p>
    <pre>	TCF	ENDOFJOB<br></pre>
    or<br>
    <pre>	TC	ENDOFJOB<br></pre>
    <h4>Accessing the DSKY</h4>
    <p>Access to the DSKY (display/keyboard) is provided by the
      flight-software in the following flight-software code sections:<br>
    </p>
    <ul>
      <li><a moz-do-not-send="true"
          href="listings/Luminary099/DISPLAY_INTERFACE_ROUTINES.agc.html">DISPLAY_INTERFACE_ROUTINES</a>,
        for which the principal documentation is in the program comments
        of the source code.</li>
      <li><a moz-do-not-send="true"
          href="listings/Luminary099/PINBALL_GAME__BUTTONS_AND_LIGHTS.agc.html">PINBALL_GAME__BUTTONS_AND_LIGHTS</a>,
        which is documented in its own program comments and in <a
          moz-do-not-send="true" href="hrst/archive/1706.pdf#page=29">Chapter





          3 of "Keyboard and Display Program and Operation"</a>.</li>
    </ul>
    <p>The DISPLAY_INTERFACE_ROUTINES are built atop the
      more-fundamental PINBALL_GAME_BUTTONS_AND_LIGHTS functionality.<br>
    </p>
    <p>You would think that given the overwhelming importance of these
      routines, there would be documentation someplace in the form of a
      tutorial that told you how to incorporate them into your
      program.&nbsp; Alas, that does not appear to be the case, so we'll
      have to work out our own guide.<br>
    </p>
    <p>When programming an app that runs under the AGC "operating
      system", your code does not have an unrestricted ability to read
      keystrokes from the DSKY, nor to display whatever it likes on the
      DSKY's display.&nbsp; In point of fact, it cannot detect those
      keystrokes at all.&nbsp; Rather, all access of the DSKY is modeled
      on the notion of "verbs" and "nouns" that pervades all discussion
      of how the astronauts interact with the DSKY, and all interactions
      with the DSKY are forced by PINBALL into that basic scheme.&nbsp;
      "Verbs" and "nouns" in this context refer not to English words
      that are verbs or nouns, but rather to 2-digit codes recognized by
      the operating system.&nbsp; The different verbs refer to the <i>context</i>
      of the data is going to be input or output; i.e., to how that data
      is used.&nbsp; Whereas the different nouns refer to the <i>format</i>
      of that data.<br>
    </p>
    <p>For example:&nbsp; Suppose the <i>desired</i> user interface of
      your app does nothing but waits for the astronaut to key in an
      endless sequence of octal numbers on the DSKY keypad.&nbsp; <i>Efficient</i>
      input via the DSKY would look like this:<br>
    </p>
    <blockquote>
      <pre>... the first octal number ... ENTR<br>... the second octal number ... ENTR<br>... the third octal number ... ENTR<br>etc.<br></pre>
    </blockquote>
    <p>But there is no way to implement such a thing under the AGC
      operating system.&nbsp; Rather, the astronaut must either input
      this data via the specific "verbs" and "nouns" already defined by
      the AGC operating system, or else your app must implement <i>new</i>
      previously-nonexistent types of verbs and nouns.&nbsp; Using
      existing verbs and nouns, the astronaut <i>might</i> enter the
      data via the keystrokes<br>
    </p>
    <blockquote>
      <pre>VERB 21 NOUN 46 ... the first octal number ... ENTR<br>VERB 21 NOUN 46 ... the second octal number ... ENTR<br>VERB 21 NOUN 46 ... the third octal number ... ENTR<br>etc.<br></pre>
    </blockquote>
    <p> </p>
    <p>But regardless of the particular verbs and nouns used, your app
      is never informed by the operating system that the VERB key has
      been pressed, nor that the NOUN key has been pressed, nor the ENTR
      key, nor any of the digit keys; only that a complete, new number
      is now available.&nbsp; Nor does your app control where or how or
      even <i>if</i> these digits are displayed on the DSKY while the
      astronaut is inputting the data.<br>
    </p>
    <p>The types of verbs and nouns recognized by the operating system
      evolved somewhat over the evolution of the AGC flight software, so
      it's not possible to give a single authoritative list of
      them.&nbsp; Instead, you have to consult the source code or
      documentation for the specific AGC software version you've chosen
      to use as your operating system.&nbsp; That said, it was <i>usually</i>
      the case that new types of verbs or nouns were merely added over
      time, rather than that the interpretation of any given verb or
      noun changed.&nbsp; Thus there plenty of verbs and nouns (like the
      VERB 21 and the NOUN 46 in the example above) that were
      identically present in all AGC software versions.<br>
    </p>
    <p><a moz-do-not-send="true" href="hrst/archive/1709b.pdf#page=46">The

        study guide</a> tells us that "The VERB codes are divided into
      two groups — Ordinary and Extended. The ordinary verbs generally
      are involved in the manipulation (loading, display, etc.) of data.
      The extended verbs, in general, are used for initiation of actions
      (moding requests, equipment operation, etc.)."&nbsp; You'll also
      see the term "regular verbs" as a synonym for "ordinary
      verbs".&nbsp; Additionally:<br>
    </p>
    <ul>
      <li>Regular verbs:</li>
      <ul>
        <li>Not restartable if terminated by an AGC restart.</li>
        <li>2-digit codes are 00-39.</li>
        <li>Implemented in PINBALL_GAME_BUTTONS_AND_LIGHTS (look for the
          label <tt>VERBTAB</tt>)</li>
        <li>Can add new types of regular verbs for codes marked as
          "spares" in the <tt>VERBTAB</tt> table.<br>
        </li>
        <li>Documented in ASSEMBLY_AND_OPERATION_INFORMATION (look for
          the string "REGULAR VERBS"), and at least for some verbs that
          existed prior to 1967 in <a moz-do-not-send="true"
            href="hrst/archive/1709b.pdf#page=49">the study guide</a>.<br>
        </li>
      </ul>
      <li>Extended verbs:</li>
      <ul>
        <li>Restartable after an AGC restart has occurred.</li>
        <li>2-digit codes are 40-99</li>
        <li>Implemented in EXTENDED_VERBS (look for the label <tt>LST2FAN</tt>)</li>
        <li>Can add new types of regular verbs for codes marked as
          "spares" in the <tt>LST2FAN</tt> table.</li>
        <li>Documented in ASSEMBLY_AND_OPERATION_INFORMATION (look for
          the string "EXTENDED VERBS"), and at least for some verbs that
          existed prior to 1967 in <a moz-do-not-send="true"
            href="hrst/archive/1709b.pdf#page=51">the study guide</a>.</li>
      </ul>
    </ul>
    <p>Here, for example, are the complete verb tables from SUNDANCE
      306, in which (barring miscounts on my part) you can see 11 spare
      regular verbs and 15 spare extended verbs which you could
      potentially define anew for your app.&nbsp; The entries in the
      table, obviously, point to subroutines implementing the particular
      types of verbs.<br>
    </p>
    <div style="height: 150px; overflow-y:auto; border: 1px solid #ccc;
      padding: 10px; ">
      <pre>VERBTAB         CADR    GODSPALM        # VB00 ILLEGAL<br>                CADR    DSPA            # VB01 DISPLAY OCT COMP 1 (R1)<br>                CADR    DSPB            # VB02 DISPLAY OCT COMP 2 (R1)<br>                CADR    DSPC            # VB03 DISPLAY OCT COMP 3 (R1)<br>                CADR    DSPAB           # VB04 DISPLAY OCT COMP 1,2 (R1,R2)<br>                CADR    DSPABC          # VB05 DISPLAY OCT COMP 1,2,3 (R1,R2,R3)<br>                CADR    DECDSP          # VB06 DECIMAL DISPLAY<br>                CADR    DSPDPDEC        # VB07 DP DECIMAL DISPLAY (R1,R2)<br>                CADR    GODSPALM        # VB08 SPARE<br>                CADR    GODSPALM        # VB09 SPARE<br>                CADR    DSPALARM        # VB10 SPARE<br>                CADR    MONITOR         # VB11 MONITOR OCT COMP 1 (R1)<br>                CADR    MONITOR         # VB12 MONITOR OCT COMP 2 (R1)<br>                CADR    MONITOR         # VB13 MONITOR OCT COMP 3 (R1)<br>                CADR    MONITOR         # VB14 MONITOR OCT COMP 1,2 (R1,R2)<br>                CADR    MONITOR         # VB15 MONITOR OCT COMP 1,2,3 (R1,R2,R3)<br>                CADR    MONITOR         # VB16 MONITOR DECIMAL<br>                CADR    MONITOR         # VB17 MONITOR DP DEC  (R1,R2)<br>                CADR    GODSPALM        # VB18 SPARE<br>                CADR    GODSPALM        # VB19 SPARE<br>                CADR    GODSPALM        # VB20 SPARE<br>                CADR    ALOAD           # VB21 LOAD COMP 1 (R1)<br>                CADR    BLOAD           # VB22 LOAD COMP 2 (R2)<br>                CADR    CLOAD           # VB23 LOAD COMP 3 (R3)<br>                CADR    ABLOAD          # VB24 LOAD COMP 1,2 (R1,R2)<br>                CADR    ABCLOAD         # VB25 LOAD COMP 1,2,3 (R1,R2,R3)<br>                CADR    GODSPALM        # VB26 SPARE<br>                CADR    DSPFMEM         # VB27 FIXED MEMORY DISPLAY<br>                CADR    GODSPALM        # VB28 SPARE<br>                CADR    GODSPALM        # VB29 SPARE<br>                CADR    VBRQEXEC        # VB30 REQUEST EXECUTIVE<br>                CADR    VBRQWAIT        # VB31 REQUEST WAITLIST<br>                CADR    VBRESEQ         # VB32 RESEQUENCE<br>                CADR    VBPROC          # VB33 PROCEED WITHOUT DATA<br>                CADR    VBTERM          # VB34 TERMINATE CURRENT TEST OR LOAD REQ<br>                CADR    VBTSTLTS        # VB35 TEST LIGHTS<br>                CADR    SLAP1           # VB36 FRESH START<br>                CADR    MMCHANG         # VB37 CHANGE MAJOR MODE<br>                CADR    GODSPALM        # VB38 SPARE<br>                CADR    GODSPALM        # VB39 SPARE<br>LST2FAN         TC      VBZERO          # VB40 ZERO (USED WITH NOUN 20 OR 72 ONLY)<br>                TC      VBCOARK         # VB41 COARSE ALIGN (USED WITH NOUN 20 OR 72 ONLY)<br>                TC      IMUFINEK        # VB42 FINE ALIGN IMU<br>                TC      IMUATTCK        # VB43  LOAD IMU ATTITUDE ERROR METERS.<br>                TC      RRDESEND        # VB44 TERMINATE CONTINUOUS DESIGNATE<br>                TC      V45             # VB45 W MATRIX MONITOR<br>                TC      ALM/END         # VB46 SPARE<br>                TC      V47TXACT        # VB47 AGS INITIALIZATION<br>                TC      DAPDISP         # VB48  LOAD A/P DATA<br>                TCF     CREWMANU        # VB49 START AUTOMATIC ATTITUDE MANEUVER<br>                TC      GOLOADLV        # VB50 PLEASE PERFORM<br>                TC      ALM/END         # VB51 SPARE<br>                TC      GOLOADLV        # VB52 PLEASE MARK X - RETICLE.<br>                TC      GOLOADLV        # VB53 PLEASE MARK Y - RETICLE.<br>                TC      GOLOADLV        # VB54 PLEASE MARK X OR Y - RETICLE<br>                TC      ALINTIME        # VB55 ALIGN TIME<br>                TC      TRMTRACK        # VB56 TERMINATE TRACKING - P20 + P25<br>                TC      ALM/END         # VB57 SPARE<br>                TC      ALM/END         # VB58 SPARE<br>                TC      ALM/END         # VB59 SPARE<br>                TC      DAPATTER        # VB60 DISPLAY DAP ATTITUDE ERROR<br>                TC      LRPOS2K         # VB61 COMMAND LR TO POSITION 2.<br>                TC      R04             # VB62 SAMPLE RADAR ONCE PER SECOND<br>                TC      TOTATTER        # VB63 DISPLAY TOTAL ATTITUDE ERROR<br>                TC      ALM/END         # VB64 SPARE<br>                TC      SNUFFOUT        # VB65 DISABLE U,V JETS DURING DPS BURNS.<br>                TC      ATTACHED        # VB66 ATTACHED   MOVE THIS TO OTHER STATE<br>                TC      ALM/END         # VB67 SPARE<br>                TC      ALM/END         # VB68 SPARE<br>                TC      VERB69          # VB69 FORCE A HARDWARE RESTART<br>                TC      V70UPDAT        # VB70 UPDATE LIFTOFF TIME.<br>                TC      V71UPDAT        # VB71 UNIVERSAL UPDATE - BLOCK ADDRESS.<br>                TC      V72UPDAT        # VB72 UNIVERSAL UPDATE - SINGLE ADDRESS.<br>                TC      V73UPDAT        # VB73 UPDATE AGC TIME (OCTAL).<br>                TC      DNEDUMP         # VB74 INITIALIZE DOWN-TELEMETRY PROGRAM FOR ERASABLE DUMP.<br>                TC      OUTSNUFF        # VB75 ENABLE U,V JETS DURING DPS BURNS.<br>                TC      MINIMP          # VB76 MINIMUM IMPULSE MODE<br>                TC      NOMINIMP        # VB77 RATE COMMAND MODE<br>                TC      R77             # VB78 START LR SPURIOUS RETURN TEST<br>                TC      R77END          # VB79 TERMINATE LR SPURIOUS RETURN TEST<br>                TC      LEMVEC          # VB80 UPDATE LEM STATE VECTOR<br>                TC      CSMVEC          # VB81 UPDATE CSM STATE VECTOR<br>                TC      V82PERF         # VB82 REQUEST ORBIT PARAM DISPLAY (R30)<br>                TC      V83PERF         # VB83 REQUEST REND PARAM DISPLAY (R31)<br>                TC      R32             # VB84 START TARGET DELTA V (R32)<br>                TC      ALM/END         # VB85 SPARE<br>                TC      ALM/END         # VB86 SPARE<br>                TC      ALM/END         # VB87 SPARE<br>                TC      ALM/END         # VB88 SPARE<br>                TC      V89PERF         # VB89 ALIGN XORZ LEM AXIS ALONG LOS (R63)<br>                TC      V90PERF         # VB90 OUT OF PLANE RENDEZVOUS DISPLAY<br>                TC      GOSHOSUM        # VB91 DISPLAY BANK SUM.<br>                TC      SYSTEST         # VB92 OPERATE IMU PERFORMANCE TEST.<br>                TC      WMATRXNG        # VB93 CLEAR RENDWFLG<br>                TC      ALM/END         # VB94 SPARE<br>                TC      UPDATOFF        # VB95 NO STATE VECTOR UPDATE ALLOWED<br>                TC      VERB96          # VB96 INTERRUPT INTEGRATION AND GO TO POO<br>                TC      ALM/END         # VB97 SPARE<br>                TC      ALM/END         # VB98 SPARE<br>                TC      GOLOADLV        # VB99 PLEASE ENABLE ENGINE</pre>
    </div>
    <p>Nouns, meanwhile, are categorized as either "normal" (codes
      00-39) or "mixed" (codes 40-99).&nbsp; The distinction, as
      explained by <a moz-do-not-send="true"
        href="hrst/archive/1709b.pdf#page=52">the study guide</a> is
      that "Normal Nouns refer to data stored in sequential memory
      registers and the data contained in or to be loaded into these
      registers must use the same scaling. ... The other type of noun
      code, the Mixed Noun, refers to data which is not necessarily
      located in sequential memory registers nor necessarily use the
      same scaling."&nbsp; And as with the verbs, these may differ a
      little from one incarnation of the AGC flight software to the
      next.&nbsp; For all AGC versions concerning us here, the nouns are
      implemented primarily in PINBALL NOUN TABLES (look for the tables
      at labels&nbsp; <tt>NNADTAB</tt> and <tt>NNTYPTAB</tt>) and
      documented in ASSEMBLY AND OPERATION INFORMATION (and often in <a
        moz-do-not-send="true" href="hrst/archive/1709b.pdf#page=53">the
        study guide</a>).&nbsp; The <tt>NNADTAB</tt> table points to
      subroutines implementing the individual nouns, whereas the <tt>NNTYPTAB</tt>
      table entries for those same nouns are numerical values whose
      bitfields provide the formats for up to 3 numerical components
      (corresponding to the 3 5-digit registers displayed on the
      DSKY).&nbsp; For illustrative purposes, the SUNDANCE 306 <tt>NNTYPTAB</tt>
      table reads:</p>
    <div style="height: 150px; overflow-y:auto; border: 1px solid #ccc;
      padding: 10px; ">
      <pre>                                                        # NN        NORMAL NOUNS<br>NNTYPTAB        OCT             00000                   # 00 NOT IN USE<br>                OCT             04040                   # 01 3COMP  FRACTIONAL<br>                OCT             04140                   # 02 3COMP  WHOLE<br>                OCT             04102                   # 03 3COMP  CDU DEGREES<br>                OCT             00000                   # 04        SPARE<br>                OCT             00504                   # 05 1COMP  DPDEG(360)<br>                OCT             02000                   # 06 2COMP  OCTAL ONLY<br>                OCT             04000                   # 07 3COMP  OCTAL ONLY<br>                OCT             04000                   # 08 3COMP  OCTAL ONLY<br>                OCT             04000                   # 09 3COMP  OCTAL ONLY<br>                OCT             00000                   # 10 1COMP  OCTAL ONLY<br>                OCT             00000                   # 11        SPARE<br>                OCT             00000                   # 12        SPARE<br>                OCT             00000                   # 13        SPARE<br>                OCT             04140                   # 14 3COMP  WHOLE<br>                OCT             00000                   # 15 1COMP  OCTAL ONLY<br>                OCT             24400                   # 16 3COMP  HMS (DEC ONLY)<br>                OCT             04102                   # 17 3COMP  CDU DEG<br>                OCT             04102                   # 18 3COMP  CDU DEG<br>                OCT             04102                   # 19 3COMP  CDU DEG<br>                OCT             04102                   # 20 3COMP  CDU DEGREES<br>                OCT             04140                   # 21 3COMP  WHOLE<br>                OCT             04102                   # 22 3COMP  CDU DEGREES<br>                OCT             00000                   # 23        SPARE<br>                OCT             24400                   # 24 3COMP  HMS (DEC ONLY)<br>                OCT             04140                   # 25 3COMP  WHOLE<br>                OCT             04000                   # 26 3COMP  OCTAL ONLY<br>                OCT             00140                   # 27 1COMP  WHOLE<br>                OCT             00000                   # 28        SPARE<br>                OCT             00000                   # 29 1COMP  OCTAL ONLY<br>                OCT             24400                   # 30 3COMP  HMS (DEC ONLY)<br>                OCT             24400                   # 31 3COMP  HMS (DEC ONLY)<br>                OCT             24400                   # 32 3COMP  HMS (DEC ONLY)<br>                OCT             24400                   # 33 3COMP  HMS (DEC ONLY)<br>                OCT             24400                   # 34 3COMP  HMS (DEC ONLY)<br>                OCT             24400                   # 35 3COMP  HMS (DEC ONLY)<br>                OCT             24400                   # 36 3COMP  HMS (DEC ONLY)<br>                OCT             24400                   # 37 3COMP  HMS (DEC ONLY)<br>                OCT             00000                   # 38        SPARE<br>                OCT             00000                   # 39        SPARE<br>                                                        # NN   MIXED NOUNS<br>                OCT             24500                   # 40 3COMP  MIN/SEC, VEL3, VEL3 (NO LOAD, DEC ONLY)<br>                OCT             00542                   # 41 2COMP  CDU DEG, ELEV DEG<br>                OCT             24410                   # 42 3COMP  POS4, POS4, VEL3(DEC ONLY)<br>                OCT             20204                   # 43 3COMP  DPDEG(360), DPDEG(360), POS4 (DEC ONLY)<br>                OCT             00410                   # 44 3COMP  POS4, POS4, MIN/SEC(NO LOAD, DEC ONLY)<br>                OCT             10000                   # 45 3COMP  WHOLE, MIN/SEC, DPDEG(360) (NO LOAD, DEC ONLY)<br>                OCT             00000                   # 46 1COMP  OCTAL ONLY<br>                OCT             00306                   # 47 2COMP  WEIGHT2 FOR EACH (DEC ONLY)<br>                OCT             01367                   # 48 2COMP  TRIM DEG2 FOR EACH(DEC ONLY)<br>                OCT             00510                   # 49 2COMP  POS4, VEL3 (DEC ONLY)<br>                OCT             00010                   # 50 3COMP  POS4, MIN/SEC, MIN/SEC (NO LOAD, DEC ONLY)<br>                OCT             00204                   # 51 2COMP  DPDEG(360), DPDEG(360) (DEC ONLY)<br>                OCT             00004                   # 52 1COMP  DPDEG(360)<br>                OCT             20512                   # 53 3COMP  VEL3, VEL3, POS4 (DEC ONLY)<br>                OCT             10507                   # 54 3COMP  POS5, VEL3, DPDEG(360) (DEC ONLY)<br>                OCT             10200                   # 55 3COMP  WHOLE, DPDEG(360), DPDEG(360) (DEC ONLY)<br>                OCT             20200                   # 56 3COMP  WHOLE, DPDEG(360), POS4 (DEC ONLY)<br>                OCT             00010                   # 57 1COMP  POS4 (DEC ONLY)<br>                OCT             24510                   # 58 3COMP  POS4, VEL3, VEL3 (DEC ONLY)<br>                OCT             24512                   # 59 3COMP  VEL3 FOR EACH (DEC ONLY)<br>                OCT             60512                   # 60 3COMP  VEL3, VEL3, COMP ALT (DEC ONLY)<br>                OCT             54000                   # 61 3COMP  MIN/SEC, MIN/SEC, POS7 (NO LOAD, DEC ONLY)<br>                OCT             24012                   # 62 3COMP  VEL3, MIN/SEC, VEL3 (NO LOAD, DEC ONLY)<br>                OCT             60512                   # 63 3COMP  VEL3, VEL3, COMP ALT (DEC ONLY)<br>                OCT             60500                   # 64 3COMP  2INT, VEL3, COMP ALT (NO LOAD, DEC ONLY)<br>                OCT             00000                   # 65 3COMP  HMS (DEC ONLY)<br>                OCT             00016                   # 66 2COMP  LANDING RADAR ALT, POSITION (NO LOAD, DEC ONLY)<br>                OCT             53223                   # 67 3COMP  LANDING RADAR VELX, Y, Z<br>                OCT             60026                   # 68 3COMP  POS7, MIN/SEC, COMP ALT (NO LOAD, DEC ONLY)<br>                OCT             24000                   # 69 3COMP  WHOLE, WHOLE, VEL3 (DEC ONLY)<br>                OCT             0                       # 70 3COMP  OCTAL ONLY FOR EACH<br>                OCT             0                       # 71 3COMP  OCTAL ONLY FOR EACH<br>                OCT             00102                   # 72 2COMP  360-CDU DEG, CDU DEG<br>                OCT             00102                   # 73 2COMP  360-CDU DEG, CDU DEG<br>                OCT             10200                   # 74 3COMP  MIN/SEC, DPDEG(360), DPDEG(360) (NO LOAD, DEC ONLY)<br>                OCT             60500                   # 75 3COMP  MIN/SEC, VEL3, COMP ALT (NO LOAD, DEC ONLY)<br>                OCT             00410                   # 76 3COMP  POS4, POS4 (DEC ONLY)<br>                OCT             00500                   # 77 2COMP  MIN/SEC, VEL3 (NO LOAD, DEC ONLY)<br>                OCT             00654                   # 78 2COMP  RR RANGE, RR RANGE RATE<br>                OCT             00102                   # 79 3COMP  CDU DEG, CDU DEG, WHOLE (DEC ONLY)<br>                OCT             00200                   # 80 2COMP  WHOLE, DPDEG(360)<br>                OCT             24512                   # 81 3COMP  VEL3 FOR EACH (DEC ONLY)<br>                OCT             24512                   # 82 3COMP  VEL3 FOR EACH (DEC ONLY)<br>                OCT             24512                   # 83 3COMP  VEL3 FOR EACH (DEC ONLY)<br>                OCT             24512                   # 84 3COMP  VEL3 FOR EACH (DEC ONLY)<br>                OCT             24512                   # 85 3COMP  VEL3 FOR EACH (DEC ONLY)<br>                OCT             24512                   # 86 3COMP  VEL3 FOR EACH (DEC ONLY)<br>                OCT             00102                   # 87 2COMP  CDU DEG FOR EACH<br>                OCT             0                       # 88 3COMP  FRAC FOR EACH (DEC ONLY)<br>                OCT             16143                   # 89 3COMP  DPDEG(90), DPDEG(90), POS5 (DEC ONLY)<br>                OCT             10507                   # 90 3COMP  POS5, VEL3, DPDEG(360) (DEC ONLY)<br>                OCT             62010                   # 91 3COMP  POS4, MIN/SEC, DPDEG(XXXX.X) (NO LOAD, DEC ONLY)<br>                OCT             62000                   # 92 3COMP  SPARE, MIN/SEC, DPDEG(XXXX.X) (NO LOAD, DEC ONLY)<br>                OCT             06143                   # 93 3COMP  DPDEG(90) FOR EACH<br>                OCT             62010                   # 94 3COMP  POS4, MIN/SEC, DPDEG(XXXX.X) (NO LOAD, DEC ONLY)<br>                OCT             04102                   # 95 3COMP  CDU DEG FOR EACH<br>                OCT             04102                   # 96 3COMP  CDU DEG FOR EACH<br>                OCT             00000                   # 97 3COMP  WHOLE FOR EACH<br>                OCT             00000                   # 98 3COMP  WHOLE, FRAC, WHOLE<br>                OCT             01572                   # 99 3COMP  POS9, VEL4 (DEC ONLY)<br></pre>
    </div>
    <p>This is significant to you, of course, only if you intend to
      create <i>new</i> types of nouns, which in spite of the
      explanations above isn't something I foresee anyone doing.&nbsp;
      For that reason — and because it's reasonably difficult to do so —
      , I admit that I have not actually made the effort to work out how
      precisely how to deal with the numerical codes in <tt>NNTYPTAB</tt>,
      nor the codes in various other associated tables within PINBALL
      NOUN TABLES, namely <tt>SFINTAB</tt> and <tt>SFOUTAB</tt>.&nbsp;
      In other words, I don't actually know in more detail at the moment
      how to implement a new noun type.&nbsp; If anyone <i>does</i>
      want to define new noun types, let me know what you figure out or
      if you need help figuring it out. </p>
    <p>As far as actually incorporating any of this into your app is
      concerned, TBD<br>
    </p>
    <h4>Restart Capability<br>
    </h4>
    <p>If you want your new app to be automatically restarted when an
      abort occurs that restarts the computer, you'll have to take steps
      to periodically save its internal state, and to add the app to the
      so-called "restart tables".&nbsp; This feature is the kind of
      thing that allowed the AGC to recover from the "1201" and "1202"
      alarms that occurred during the Apollo 11 landing.&nbsp; <br>
    </p>
    <p>Since I don't fully understand this topic yet, I'll defer
      discussion of it.&nbsp; Although frankly, I doubt that it's of too
      much interest anyway in a simulation environment.<br>
    </p>
    <h4>Night Watchman</h4>
    <p>The AGC hardware incorporates a so-called "night watchman"
      circuit that monitors the activity of the AGC software and
      triggers a system restart if it appears that the software has
      become unresponsive.&nbsp; The term "night watchman" was specific
      to the AGC development team, and was what might more-commonly be
      known today as a <i><a moz-do-not-send="true"
          href="https://en.wikipedia.org/wiki/Watchdog_timer">watchdog
          timer</a></i>.&nbsp; If you execute your new app+operating
      system on a physical AGC or a simulation of AGC electronics, your
      software will have to periodically service the night watchman
      circuit to insure that it doesn't spontaneously restart the AGC. <br>
    </p>
    <p>Specifically, the night watchman circuit triggers a restart if
      the software fails to access address 67 (octal) at least once
      every 0.64 second.&nbsp; This address is given the symbolic name <tt>NEWJOB</tt>.&nbsp;







      As mentioned above, each job is supposed to periodically query <tt>NEWJOB</tt>
      anyway, so if that has been implemented properly you have nothing
      to worry about.<br>
    </p>
    <p>How might such a night-watchman failure occur?&nbsp; Well,
      perhaps your app disables the CPU's interrupts without reenabling
      them afterward.&nbsp; Or perhaps it uses more than 0.64 seconds
      between queries of <tt>NEWJOB</tt>.<br>
    </p>
    <p>Note, though, that the software-only AGC emulator (known as <b>yaAGC</b>)
      provided by the Virtual AGC Project does not itself include a
      simulated night-watchman circuit, and thus your app wouldn't need
      to service the night watchman if your intention was to run your
      app only in the <b>VirtualAGC</b> simulation environment.<br>
    </p>
    <h3>Step 5: Automatically Starting Your App</h3>
    <p>As implemented so far by the steps above, you'll have a modified
      AGC flight program in which the astronaut could optionally start
      your new app manually by means of DSKY commands.&nbsp; For
      example, if your new app has been implemented to have the 2-digit
      code 99, then the astronaut could start the app by means of the
      keystrokes <tt>VERB 37 ENTR 99 ENTR</tt>.<br>
    </p>
    <p>But perhaps that's not good enough for you, and you'd prefer that
      your app just start up automatically without astronaut
      participation.&nbsp; In that case, we need to add some additional
      instructions to the flight software to make that happen.&nbsp;
      What are those instructions?&nbsp; There are two cases:&nbsp; Does
      your app need a "vector accumulator" (VAC) for arithmetical
      operations performed by the INTERPRETER, or does it not?&nbsp; Of
      course, if your app has no interpreter language in it, then it
      certainly does not need a VAC.&nbsp; <br>
    </p>
    <p>Let's suppose that (as above) your app's code is at label <tt>MYAPP</tt>,
      in fixed-memory bank 15, with variables (other than the VAC, if
      any) in erasable-memory bank 4.&nbsp; Let's suppose also that you
      want your app to have job-priority 3.&nbsp; If your app needs a
      VAC, then you could start its job with the instructions<br>
    </p>
    <pre>	CAF	3<br>	TC	FINDVAC<br>	EBANK=	4<br>	2CADR	MYAPP<br></pre>
    <p>whereas if no VAC is needed,<br>
    </p>
    <pre>	CAF	3<br>	TC	NOVAC<br>	EBANK=	4<br>	2CADR	MYAPP</pre>
    <p>Note the use of the <tt>EBANK=</tt> pseudo-op, which we also
      used earlier, explaining that it tells the assembler which
      erasable-memory bank is currently in use.&nbsp; The <tt>EBANK=</tt>
      setting generally stays in effect until another <tt>EBANK=</tt>
      (or <tt>SETLOC</tt>) is encountered, which might cause you to
      worry that the <tt>EBANK=</tt> has to be undone in order to avoid
      messing up whatever lines of code <i>follow</i> the instructions
      above.&nbsp; But fortunately not!&nbsp; Whenever a <tt>2CADR</tt>
      pseudo-op immediately follows an <tt>EBANK=</tt>, the assembler
      knows to use the selected erasable-bank setting only for the <tt>2CADR</tt>,
      while returning for subsequent lines to whatever erasable-bank
      setting had been previously in place.<br>
    </p>
    <p><i>Where</i> should you put these instructions to insure that
      they are executed at startup?&nbsp; TBD<br>
    </p>
    <h3>Step 6: Assembly</h3>
    From a command line, <tt>cd</tt> into the folder containing the
    code for your operating system plus app.&nbsp; You'll notice that
    the folder contains a Makefile.&nbsp; Ignore it!&nbsp; Instead,
    assemble your program by running the following command:<br>
    <pre>	../yaYUL/yaYUL --unpound-page MAIN.agc &gt;MAIN.agc.lst<br></pre>
    (In Microsoft Windows, you'd need to use backward slashes.&nbsp; I'm
    assuming that whether you're using Linux, Mac OS, or Windows, that
    you've built Virtual AGC for whatever computer system you're
    running, and thus have available its programs like <b>yaYUL</b>, <b>yaAGC</b>,
    <b>VirtualAGC</b>, and so on.)&nbsp; <br>
    <br>
    Upon success, you'll notice that the following new files have been
    created:<br>
    <ul>
      <li>MAIN.agc.bin is the assembled form of your program.</li>
      <li>MAIN.agc.lst is the listing file from the assembly process.</li>
      <li>MAIN.agc.symtab is a symbol-table file, used only for certain
        types of debugging, and can be ignored for now.<br>
      </li>
    </ul>
    Of course, there <i>will</i> be assembly errors at first, unless
    you're some kind of programming god, so you'll have to fix those
    before proceeding.&nbsp; The error messages in the listing file
    MAIN.agc.lst are your friend.&nbsp; Good luck!<br>
    <h3>Step 7: Running It In Simulation</h3>
    <p>I don't really know how you intend to run the simulation
      containing the AGC flight software with your new app added to
      it.&nbsp; Perhaps you want to run it in Orbiter.&nbsp; Or perhaps
      you want to run it on an AGC you're physically emulating with
      ASICs.&nbsp; If so, I have no insight.<br>
    </p>
    <p>Let's suppose, however, you want to run it in Virtual AGC's
      software-only simulation environment.&nbsp; Once upon a time, our
      <b>VirtualAGC</b> GUI wrapper allowed you to specify and run your
      own custom AGC program, which would be ideal for this
      scenario.&nbsp; Unfortunately, that capability was dropped many
      years ago.&nbsp; However, we can still fool <b>VirtualAGC</b>
      anyway to do most of the work for us.&nbsp; Here's how.<br>
    </p>
    <ol>
      <li>Run <b>VirtualAGC</b>, and use it to run an AGC simulation of
        a configuration as close to what you've developed as
        possible.&nbsp; For example, if you used SUNDANCE 306 as the
        basis for the operating system hosting your app, and if the only
        peripheral you want is a DSKY, then use <b>VirtualAGC</b> to
        run an Apollo 9 LM simulation with no optional peripheral
        devices selected in the <b>VirtualAGC</b> GUI.</li>
      <li>Once the simulation starts, one of the windows that pops up is
        called "Simulation Status".&nbsp; Push the button labeled
        "More", which will show you something similar to the following:</li>
    </ol>
    <blockquote>
      <blockquote>
        <pre>To do the same thing from a command line ...<br>cd /mnt/STORAGE/home/rburkey/VirtualAGC/Resources<br>./simulate<br><br>The contents of "simulate" are:<br>#!/bin/sh<br>PIDS=<br>rm LM.core<br>rm CM.core<br>sleep 0.2<br>../bin/yaAGC --core="source/Sundance306ish/Sundance306ish.bin" --port=19797 --cfg=CM.ini &amp;<br>PIDS="$! ${PIDS}"<br>../bin/yaDSKY2 --x=4645 --y=5 --cfg=CM.ini --port=19797 &amp;<br>PIDS="$! ${PIDS}"<br>sleep 0.2<br>export PIDS<br>ps auxww | egrep '\.\./bin/|VirtualAGC.tcl'<br>../bin/SimStop<br></pre>
      </blockquote>
    </blockquote>
    <ol start="3">
      <li>What this tells you is that there is a script file called
        "simulate" in a particular folder, and it tells you how to run
        that script from a command line.&nbsp; You don't need to
        actually <i>do</i> that, unless you want to test that the
        instructions are valid, but you can if you like.&nbsp; You'll
        first need to exit the AGC simulation that's already
        running.&nbsp; At any rate, running "simulate" would produce the
        identical effect as running the simulation instead from <b>VirtualAGC</b>.</li>
      <li>Edit the "simulate" file, using a text-editor program,
        replacing "source/Sundance306ish/Sundance306ish.bin" by a path
        to your own program, as assembled in Step 6 above.</li>
      <li>You should close the AGC simulation (and if you like,
        terminate <b>VirtualAGC</b>).&nbsp; We needed these things only
        to generation the "simulate" file.<br>
      </li>
      <li>Run the edited "simulate" file from the command line.</li>
      <li>If your app is supposed to be started from the DSKY, rather
        than starting automatically, then start it by keying in <tt>VERB







          37 ENTR</tt>, followed by the 2-digit code you've associated
        with your app, followed by <tt>ENTR</tt>.<br>
      </li>
      <li>Enjoy!</li>
    </ol>
    <h3>Step 8:&nbsp; Running It In a Graphical Debugger</h3>
    <p>The final step in the preceding section, "Enjoy!", is of course
      errant nonsense, because in real life your program isn't going to
      actually work until you've done a lot of debugging on it.&nbsp;
      The good news is that any version of AGC software can be debugged
      via the <a moz-do-not-send="true"
        href="https://www.codeblocks.org/"><b>Code::Blocks</b> graphical
        debugger</a>, as long as a suitable configuration file has been
      produced.&nbsp; (They can also be debugged using built-in <a
        moz-do-not-send="true" href="https://www.sourceware.org/gdb/"><b>gdb</b></a>
      console-style commands from a <b>yaAGC</b> command line, albeit
      usually with greater difficulty.&nbsp; You don't actually <i>use</i>
      <b>gdb</b> for the debugging, just its "style".)<br>
    </p>
    <p>Of course, you must install <b>Code::Blocks</b> on your computer
      for this debugging option to be available.<br>
    </p>
    <p>One requirement for graphical debugging via <b>Code::Blocks</b>
      is that there be an available <b>Code::Blocks</b> configuration
      file for the AGC software version you want to debug.&nbsp; If
      you're running Linux, Mac OS, or Windows (with MSYS2), there's a
      script in the Virtual AGC source tree that should create such a
      configuration file for you.&nbsp; It requires that your
      source-code folder (say, MYAPP) is stored at the top level of the
      Virtual AGC source tree.&nbsp; From a command line, just <tt>cd</tt>
      into the Virtual AGC source tree, and use the command<br>
    </p>
    <blockquote>
      <pre>./createCBP.sh MYAPP<br></pre>
    </blockquote>
    <p>and you should find that the configuration file MYAPP/MYAPP.cbp
      has been created.&nbsp; If this technique fails for you, I'd
      suggest just getting the configuration file for the AGC version
      you're basing your software on (such as
      Luminary099/Luminary099.cbp), copying/renaming it to
      MYAPP/MYAPP.cbp, and editing it in a text-editing program.&nbsp;
      Recognizing that the list of AGC source-code files is given within
      MYAPP/MAIN.cbp, the changes you need to make to MYAPP/MYAPP.cbp
      should be obvious upon inspection, even if potentially tedious.<br>
    </p>
    <p>To start the graphical debugger for MYAPP, you should be able to
      navigate in your desktop file-system browser to your MYAPP/
      folder, and double-click on the file MYAPP.cbp. <br>
    </p>
    <p>Techniques for actually <i>using</i> <b>Code::Blocks</b> (or <b>gdb</b>-style







      commands) or for debugging AGC programs in general are far outside
      the scope of what I want to discuss here.&nbsp; Some additional
      explanation appears on our <a moz-do-not-send="true"
        href="download.html#Characteristics_of_the_Virtual_AGC_VM">download







        page</a> (within the context of our Virtual AGC virtualbox VM),
      at the same time pointing out additional resources having more
      detail, both general and Virtual-AGC-specific.<br>
    </p>
    <br>
    <hr style="width: 100%; height: 2px;">
    <center> <br>
      <span style="color: rgb(84, 89, 93); font-family: sans-serif;
        font-size: 11.05px; font-style: normal; font-variant: normal;
        font-weight: normal; letter-spacing: normal; line-height:
        16.575px; orphans: auto; text-align: center; text-indent: 0px;
        text-transform: none; white-space: normal; widows: 1;
        word-spacing: 0px; -webkit-text-stroke-width: 0px; display:
        inline !important; float: none; background-color: rgb(255, 255,
        255);"> This page is available under the <a
          href="https://creativecommons.org/publicdomain/zero/1.0/">Creative
Commons







          No Rights Reserved License</a></span><br>
      <i><font size="-1">Last modified by <a
            href="mailto:info@sandroid.org">Ronald Burkey</a> on
          2026-02-08.<br>
          <br>
          <a href="http://www.ibiblio.org"><img style="border: 0px solid
              ; width: 300px; height: 100px;" alt="Virtual AGC is hosted
              by ibiblio.org" src="hosted.png" width="300" height="100"></a><br>
        </font></i> </center>
    <br>
    <br>
  </body>
</html>
